(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{411:function(s,a,n){"use strict";n.r(a);var t=n(4),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h4",{attrs:{id:"九、argocd配置cd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、argocd配置cd"}},[s._v("#")]),s._v(" 九、Argocd配置CD")]),s._v(" "),a("h5",{attrs:{id:"安装argocd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装argocd"}},[s._v("#")]),s._v(" 安装Argocd")]),s._v(" "),a("blockquote",[a("p",[s._v("项目路径: kubernetes-software-yaml/argocd")]),s._v(" "),a("p",[s._v("https://argo-cd.readthedocs.io/en/stable/")]),s._v(" "),a("p",[s._v("https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接使用编排文件进行安装(这里采用编排文件进行安装)")]),s._v("\nkubectl create namespace argocd\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" install.yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server\nkubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用helm进行安装")]),s._v("\nhelm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" argo https://argoproj.github.io/argo-helm\nhelm search repo argocd\nhelm pull argo/argo-cd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--untar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.35")]),s._v(".4\n\n$ helm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--install")]),s._v(" argocd "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\nRelease "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"argocd"')]),s._v(" does not exist. Installing it now.\nNAME: argocd\nLAST DEPLOYED: Thu Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":03:23 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nNAMESPACE: argocd\nSTATUS: deployed\nREVISION: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\nIn order to access the server UI you have the following options:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". kubectl port-forward service/argocd-server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":443\n    and "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" the browser on http://localhost:8080 and accept the certificate\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" ingress "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the values "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server.ingress.enabled"')]),s._v(" and either\n      - Add the annotation "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ssl passthrough: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/ingress.md"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#option-1-ssl-passthrough")]),s._v("\n      - Add the "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--insecure"')]),s._v(" flag to "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server.extraArgs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the values "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" and terminate SSL at your ingress: https://github.com/argoproj/argo-cd/blob/master/docs/operator-manual/ingress.md"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#option-2-multiple-ingress-objects-and-hosts")]),s._v("\n\nAfter reaching the UI the first "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" you can login with username: admin and the random password generated during the installation. You can "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" the password by running:\n\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd get secret argocd-initial-admin-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.password}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://github.com/argoproj/argo-cd/blob/master/docs/getting_started.md"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4-login-using-the-cli)")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ingress 配置(这里采用的Nginx Ingress)")]),s._v("\n$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" argo-ingress.yaml  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server\ningress.networking.k8s.io/argocd-server-ingress created "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" argo-ingress.yaml  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\ningress.networking.k8s.io/argocd-server-ingress created\n\n$ kubectl get ingress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\nNAME                    CLASS    HOSTS                   ADDRESS   PORTS     AGE\nargocd-server-ingress   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   argocddemo.chsaos.com             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   3s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("官方文档: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-1-ssl-passthrough")]),s._v(" "),a("blockquote",[a("p",[s._v("问题： rgocd 将您重定向的次数过多 "),a("code",[s._v("If you encounter a redirect loop or are getting a 307 response code")])]),s._v(" "),a("p",[s._v("解决: "),a("code",[s._v("then you need to force the nginx ingress to connect to the backend using HTTPS.")])])])])]),s._v(" "),a("h5",{attrs:{id:"argocd客户端安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#argocd客户端安装"}},[s._v("#")]),s._v(" Argocd客户端安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--silent")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://api.github.com/repos/argoproj/argo-cd/releases/latest"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\"tag_name\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'s/.*"([^"]+)".*/\\1/\'')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sSL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$VERSION")]),s._v("/argocd-linux-amd64\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/argocd \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sfv")]),s._v(" /usr/local/bin/argocd /usr/bin/\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看密码")]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd get secret argocd-initial-admin-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.password}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\nFMgfgp1RLZ2HRLbz\n \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# argocd客户端连接")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLUSTER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("kubectl get svc argocd-server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.clusterIP}"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n$ argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--insecure")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CLUSTER_IP}")]),s._v(":443\nUsername: admin\nPassword: \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin:login'")]),s._v(" logged "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" successfully\nContext "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.103.59.183:443'")]),s._v(" updated\n \n $ argocd version\nargocd: v2.5.2+148d8da\n  BuildDate: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-07T17:06:04Z\n  GitCommit: 148d8da7a996f6c9f4d102fdd8e688c2ff3fd8c7\n  GitTreeState: clean\n  GoVersion: go1.18.7\n  Compiler: gc\n  Platform: linux/amd64\nargocd-server: v2.5.2+148d8da\n  BuildDate: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-07T16:42:47Z\n  GitCommit: 148d8da7a996f6c9f4d102fdd8e688c2ff3fd8c7\n  GitTreeState: clean\n  GoVersion: go1.18.8\n  Compiler: gc\n  Platform: linux/amd64\n  Kustomize Version: v4.5.7 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-08-02T16:35:54Z\n  Helm Version: v3.10.1+g9f88ccb\n  Kubectl Version: v0.24.2\n  Jsonnet Version: v0.18.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("h5",{attrs:{id:"域名访问argocd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#域名访问argocd"}},[s._v("#")]),s._v(" 域名访问Argocd")]),s._v(" "),a("ul",[a("li",[s._v("https://argocddemo.chsaos.com/")]),s._v(" "),a("li",[s._v("默认用户名: admin")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看密码")]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd get secret argocd-initial-admin-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.password}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\nFMgfgp1RLZ2HRLbz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221117181927135.png",alt:"image-20221117181927135"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221117182009060.png",alt:"image-20221117182009060"}})]),s._v(" "),a("h5",{attrs:{id:"argocd上添加代码仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#argocd上添加代码仓库"}},[s._v("#")]),s._v(" argocd上添加代码仓库")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118094143002.png",alt:"image-20221118094143002"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118094521750.png",alt:"image-20221118094521750"}})]),s._v(" "),a("h5",{attrs:{id:"创建应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建应用"}},[s._v("#")]),s._v(" 创建应用")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118094854243.png",alt:"image-20221118094854243"}})]),s._v(" "),a("ul",[a("li",[s._v("同步策略: https://argo-cd.readthedocs.io/en/stable/user-guide/sync-options/")])]),s._v(" "),a("blockquote",[a("p",[s._v("Application Name: myapp-dev")]),s._v(" "),a("p",[s._v("Project Name: default")]),s._v(" "),a("p",[s._v("SYNC POLICY: Automatic")]),s._v(" "),a("p",[s._v("SYNC OPTIONS: PRUNT LAST")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118095851460.png",alt:"image-20221118095851460"}})]),s._v(" "),a("blockquote",[a("p",[s._v("Repository URL: https://gitlabdemo.chsaos.com/infra/devops-cd.git")]),s._v(" "),a("p",[s._v("Revision: HEAD")]),s._v(" "),a("p",[s._v("Path: devops-simple-java/")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118162227505.png",alt:"image-20221118162227505"}})]),s._v(" "),a("blockquote",[a("p",[s._v("Cluster URL: https://kuberntes.default.svc")]),s._v(" "),a("p",[s._v("Namespace: dev")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118100242275.png",alt:"image-20221118100242275"}})]),s._v(" "),a("ul",[a("li",[s._v("https://argo-cd.readthedocs.io/en/stable/user-guide/kustomize/")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118165738185.png",alt:"image-20221118165738185"}})]),s._v(" "),a("h5",{attrs:{id:"app-healh问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-healh问题"}},[s._v("#")]),s._v(" "),a("code",[s._v("APP HEALH")]),s._v("问题")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ArgoCD Ingress资源一直处于Progressing状态")])])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("Argocd")]),s._v("一个"),a("code",[s._v("bug")]),s._v(","),a("code",[s._v("ingress")]),s._v("的健康检查必须要"),a("code",[s._v("loadBalance")]),s._v("有值,不然就不通过,但是并不影响使用")]),s._v(" "),a("p",[s._v("这个问题需要分版本做不同的处理;主要是通过"),a("code",[s._v("ArgoCD")]),s._v("健康检查的自定义的资源检查来排除对"),a("code",[s._v("Ingress")]),s._v("的检查")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("参考官方文档")]),s._v(" "),a("blockquote",[a("p",[s._v("https://argo-cd.readthedocs.io/en/stable/operator-manual/health/#ingress")]),s._v(" "),a("p",[s._v("https://github.com/argoproj/argo-cd/issues/1704")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118215018226.png",alt:"image-20221118215018226"}})]),s._v(" "),a("h6",{attrs:{id:"nginx-ingress处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-ingress处理"}},[s._v("#")]),s._v(" "),a("code",[s._v("Nginx Ingress")]),s._v("处理")]),s._v(" "),a("ul",[a("li",[s._v("查看"),a("code",[s._v("Nginx")]),s._v("的版本")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Nginx Ingress 中Nginx的版本")]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" ingress-nginx-controller-b7db2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" ingress-nginx -- /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -V"')]),s._v("\nnginx version: nginx/1.21.6\nbuilt by gcc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.2")]),s._v(".1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20220219")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Alpine "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.2")]),s._v(".1_git20220219"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nbuilt with OpenSSL "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1q  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" Jul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running with OpenSSL "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1s  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("v1.20.0")]),s._v("及以上版本处理")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑Argocd的configmap")]),s._v("\n$ kubectl get cm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\nNAME                        DATA   AGE\nargocd-cm                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      28h\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n$ kubectl edit cm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd argocd-cm\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please edit the object below. Lines beginning with a '#' will be ignored,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and an empty file will abort the edit. If an error occurs while saving this file will be")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reopened with the relevant failures.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n  labels:\n    app.kubernetes.io/name: argocd-cm\n    app.kubernetes.io/part-of: argocd\n  name: argocd-cm\n  namespace: argocd\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\ndata:\n  resource.customizations: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    networking.k8s.io/Ingress:\n        health.lua: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n          hs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          hs.status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Healthy"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" hs\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Argocd登录密码")]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd get secret argocd-initial-admin-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.password}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\nFMgfgp1RLZ2HRLbz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Argocd Service IP地址")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLUSTER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("kubectl get svc argocd-server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.clusterIP}"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用CLUSTER_IP登录Argocd")]),s._v("\n$ argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--insecure")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CLUSTER_IP}")]),s._v(":443\nUsername: admin\nPassword: \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin:login'")]),s._v(" logged "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" successfully\nContext "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.103.59.183:443'")]),s._v(" updated\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Argocd的APP 列表")]),s._v("\n$ argocd app list\nNAME              CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH       SYNCPOLICY  CONDITIONS  REPO                                               "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("                 TARGET\nargocd/myapp-dev  https://kubernetes.default.svc  dev        default  Synced  Progressing  Auto        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      https://gitlabdemo.chsaos.com/infra/devops-cd.git  devops-simple-java/  HEAD\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用同步")]),s._v("\n$ argocd app "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" argocd/myapp-dev "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\nTIMESTAMP                  GROUP                    KIND   NAMESPACE                  NAME    STATUS   HEALTH            HOOK  MESSAGE\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18T22:05:32+08:00                        Service         dev           the-service    Synced  Healthy                  \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18T22:05:32+08:00   apps              Deployment         dev        the-deployment    Synced  Healthy                  \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18T22:05:32+08:00  networking.k8s.io     Ingress         dev           the-ingress    Synced  Progressing              \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18T22:05:32+08:00                        Service         dev           the-service    Synced  Healthy                  service/the-service unchanged\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18T22:05:32+08:00   apps              Deployment         dev        the-deployment    Synced  Healthy                  deployment.apps/the-deployment unchanged\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18T22:05:32+08:00  networking.k8s.io     Ingress         dev           the-ingress    Synced  Progressing              ingress.networking.k8s.io/the-ingress unchanged\n\nName:               argocd/myapp-dev\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          dev\nURL:                https://10.103.59.183/applications/argocd/myapp-dev\nRepo:               https://gitlabdemo.chsaos.com/infra/devops-cd.git\nTarget:             HEAD\nPath:               devops-simple-java/\nSyncWindow:         Sync Allowed\nSync Policy:        Automated\nSync Status:        Synced to HEAD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fbc4a6c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nHealth Status:      Healthy\n\nOperation:          Sync\nSync Revision:      fbc4a6c57f7cbbf1baa63b878bac2cefcad17c60\nPhase:              Succeeded\nStart:              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":05:32 +0800 CST\nFinished:           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-11-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":05:32 +0800 CST\nDuration:           0s\nMessage:            successfully synced "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("all tasks run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nGROUP              KIND        NAMESPACE  NAME            STATUS  HEALTH   HOOK  MESSAGE\n                   Service     dev        the-service     Synced  Healthy        service/the-service unchanged\napps               Deployment  dev        the-deployment  Synced  Healthy        deployment.apps/the-deployment unchanged\nnetworking.k8s.io  Ingress     dev        the-ingress     Synced  Healthy        ingress.networking.k8s.io/the-ingress unchanged\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看应用的HEALTHY状态")]),s._v("\n$ argocd app list\nNAME              CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                               "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("                 TARGET\nargocd/myapp-dev  https://kubernetes.default.svc  dev        default  Synced  Healthy  Auto        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      https://gitlabdemo.chsaos.com/infra/devops-cd.git  devops-simple-java/  HEAD\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("v1.20.0")]),s._v("版本以下版本处理")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑Argocd的configmap")]),s._v("\n$ kubectl get cm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\nNAME                        DATA   AGE\nargocd-cm                   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      28h\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n$ kubectl edit cm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd argocd-cm\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please edit the object below. Lines beginning with a '#' will be ignored,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and an empty file will abort the edit. If an error occurs while saving this file will be")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reopened with the relevant failures.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n  labels:\n    app.kubernetes.io/name: argocd-cm\n    app.kubernetes.io/part-of: argocd\n  name: argocd-cm\n  namespace: argocd\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\ndata:\n  resource.customizations.health.extensions_Ingress: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    hs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    hs.status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Healthy"')]),s._v("\n    hs.message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SoulChild"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" hs\n  resource.customizations.useOpenLibs.extensions_Ingress: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Argocd登录密码")]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd get secret argocd-initial-admin-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.password}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Argocd Service IP地址")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLUSTER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("kubectl get svc argocd-server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.clusterIP}"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用CLUSTER_IP登录Argocd")]),s._v("\n$ argocd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--insecure")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CLUSTER_IP}")]),s._v(":443\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Argocd的APP 列表")]),s._v("\n$ argocd app list\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用同步")]),s._v("\n$ argocd app "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" argocd/myapp-dev "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看应用的HEALTHY状态")]),s._v("\n$ argocd app list\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br")])]),a("p",[a("strong",[s._v("WEB页面恢复正常")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118221013276.png",alt:"image-20221118221013276"}})]),s._v(" "),a("h5",{attrs:{id:"通过域名访问服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过域名访问服务"}},[s._v("#")]),s._v(" 通过域名访问服务")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("testcoolops.chsaos.com")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看Java服务的Igress域名")]),s._v("\n$ kubectl get ns\nNAME                   STATUS   AGE\nargocd                 Active   29h\ndefault                Active   2d11h\ndev                    Active   30h\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n$ kubectl get ingress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" dev\nNAME          CLASS    HOSTS                    ADDRESS   PORTS     AGE\nthe-ingress   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   testcoolops.chsaos.com             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   174m\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118221910498.png",alt:"image-20221118221910498"}})]),s._v(" "),a("h4",{attrs:{id:"十、集成gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十、集成gitlab"}},[s._v("#")]),s._v(" 十、集成"),a("code",[s._v("Gitlab")])]),s._v(" "),a("h5",{attrs:{id:"通过webhook触发jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过webhook触发jenkins"}},[s._v("#")]),s._v(" 通过"),a("code",[s._v("Webhook")]),s._v("触发"),a("code",[s._v("Jenkins")])]),s._v(" "),a("blockquote",[a("p",[s._v("在"),a("code",[s._v("Jenkins")]),s._v("中选择项目,在项目中配置"),a("code",[s._v("gitlab")]),s._v("触发")]),s._v(" "),a("p",[a("code",[s._v("GitLab. GitLab webhook UR")]),s._v(": http://jenkinsdemo.chsaos.com/project/devops-simple-java_TEST")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118224545426.png",alt:"image-20221118224545426"}})]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("Secret token")]),s._v(": eb5c5c10d5a421ed8fab115a31651f3d")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118224941459.png",alt:"image-20221118224941459"}})]),s._v(" "),a("h5",{attrs:{id:"gitlab上配置集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab上配置集成"}},[s._v("#")]),s._v(" "),a("code",[s._v("Gitlab")]),s._v("上配置集成")]),s._v(" "),a("blockquote",[a("p",[s._v("进入项目--\x3e项目设置--\x3e集成")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118225417415.png",alt:"image-20221118225417415"}})]),s._v(" "),a("ul",[a("li",[s._v("配置"),a("code",[s._v("Jenkins")]),s._v("上生成的回调"),a("code",[s._v("URL")]),s._v("和"),a("code",[s._v("TOKEN")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118225716505.png",alt:"image-20221118225716505"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118225743528.png",alt:"image-20221118225743528"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Gitlab")]),s._v("手动发送"),a("code",[s._v("test")]),s._v("观察是否触发流水线")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118225939794.png",alt:"image-20221118225939794"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118230030878.png",alt:"image-20221118230030878"}})]),s._v(" "),a("ul",[a("li",[s._v("到"),a("code",[s._v("Argocd")]),s._v("WEB界面手动"),a("code",[s._v("SYNC")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118230822912.png",alt:"image-20221118230822912"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118230857207.png",alt:"image-20221118230857207"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118230259475.png",alt:"image-20221118230259475"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118230556679.png",alt:"image-20221118230556679"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("访问"),a("code",[s._v("Java Service")]),s._v("Ingress 域名")]),s._v(" "),a("blockquote",[a("p",[s._v("https://testcoolops.chsaos.com/hello")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221118230653481.png",alt:"image-20221118230653481"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);