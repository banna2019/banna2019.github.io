(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{418:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h4",{attrs:{id:"一、内容介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、内容介绍"}},[s._v("#")]),s._v(" 一、内容介绍")]),s._v(" "),a("ul",[a("li",[s._v("Provider插件")]),s._v(" "),a("li",[s._v("Resource资源")]),s._v(" "),a("li",[s._v("DataSuource数据源")]),s._v(" "),a("li",[s._v("Variable变量")]),s._v(" "),a("li",[s._v("Output输出")])]),s._v(" "),a("h4",{attrs:{id:"二、语法介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、语法介绍"}},[s._v("#")]),s._v(" 二、语法介绍")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Terraform")]),s._v("的配置文件都是以"),a("code",[s._v(".tf")]),s._v("为后缀;")]),s._v(" "),a("li",[a("code",[s._v("Terraform")]),s._v("支持两种模式"),a("code",[s._v("HCL、JSON")]),s._v(";")]),s._v(" "),a("li",[s._v("HashiCorp Configuration Language")])]),s._v(" "),a("h4",{attrs:{id:"三、provider插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、provider插件"}},[s._v("#")]),s._v(" 三、Provider插件")]),s._v(" "),a("ul",[a("li",[s._v("Terraform通过provider管理基础设施,使用provider与云供应商API进行交互;")]),s._v(" "),a("li",[s._v("每个Provider都包含相关的资源呵呵数据源;")]),s._v(" "),a("li",[s._v("provider: https://registry.terraform.io/browse/providers")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20220906163244749.png",alt:"image-20220906163244749"}})]),s._v(" "),a("h5",{attrs:{id:"声明provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明provider"}},[s._v("#")]),s._v(" 声明Provider")]),s._v(" "),a("ul",[a("li",[s._v("每个"),a("code",[s._v("Terrform")]),s._v("模块必须声明它需要哪些"),a("code",[s._v("Provider")]),s._v(",以便"),a("code",[s._v("Terraform")]),s._v("可以安装和使用它们.")]),s._v(" "),a("li",[s._v("提供者要求在一个"),a("code",[s._v("required_providers")]),s._v("块中.")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## versions.tf")]),s._v("\nterraform "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  required_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.2.8"')]),s._v(" // 这里是terraform的版本号,可以通过"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("terraform "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("获取到\n  required_providers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    alicloud "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      //原地址\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"aliyun/alicloud"')]),s._v("\n      //版本\n      version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.183.0"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h5",{attrs:{id:"声明provider-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明provider-2"}},[s._v("#")]),s._v(" 声明Provider")]),s._v(" "),a("ul",[a("li",[s._v("关键字"),a("code",[s._v("provider")])]),s._v(" "),a("li",[a("code",[s._v("Provider")]),s._v("名称")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provider.tf")]),s._v("\n\nprovider "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\taccess_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.alicloud_access_key\n\tsecret_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.alicloud_secret_key\n\tregion "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.region\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\nprovider "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PROVIDER_NAME"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t//主题部分\n\t//配置参数\n\taccess_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.alicloud_access_key\n\tsecret_key "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.alicloud_secret_key\n\tregion "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.region\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h5",{attrs:{id:"alias-配置多个provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alias-配置多个provider"}},[s._v("#")]),s._v(" alias-配置多个Provider")]),s._v(" "),a("ul",[a("li",[s._v("可以为同一个Provider定义多个配置,并选择基于每个资源或每个模块使用哪一个.这样做的主要原因是"),a("strong",[s._v("支持一个云平台的多个区域")])]),s._v(" "),a("li",[s._v("引用方式: "),a("PROVIDER",{attrs:{NAME:""}},[s._v("."),a("ALIAS",[s._v(", alicloud.beijing")])],1)],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provider.tf")]),s._v("\nprovider "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"beijing"')]),s._v("\n\tregion "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-beijng-b"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# provider.tf")]),s._v("\nprovider "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hanzhou"')]),s._v("\n\tregion "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-hanzhou-b"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"四、resource资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、resource资源"}},[s._v("#")]),s._v(" 四、Resource资源")]),s._v(" "),a("ul",[a("li",[s._v("资源来自"),a("code",[s._v("Provider")]),s._v(",是"),a("code",[s._v("Terraform")]),s._v("中最重要的元素.每个资源块描述一个或多个基础对象,例如网络、计算实例或更高级别的组件,例如DNS记录.")]),s._v(" "),a("li",[s._v("资源名称必须以字母或下划线开头,并且只能包含字母、数字、下划线和破折号")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("resource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resource_type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t// resource_config\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"resource-ecs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resource-ecs"}},[s._v("#")]),s._v(" Resource-ECS")]),s._v(" "),a("ul",[a("li",[s._v("定义一台ECS实例: 可用区、安全组、实例规格、系统盘类型、镜像、实例名称、带宽、交换机、付费类型、账户密码")]),s._v(" "),a("li",[s._v("https://registry.terraform.io/providers/aliyun/alicloud/latest/docs/resources/instance")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# alicloud-ecs.tf")]),s._v("\nresource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_instance"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myecs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  provider                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud.shanghai\n  availability_zone          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-shanghai-b"')]),s._v("\n  security_groups            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud_security_group.group.*.id\n  instance_type              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs.g7.large"')]),s._v("\n  system_disk_category       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cloud_essd"')]),s._v("\n  system_disk_name           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tf_system_disk_name"')]),s._v("\n  system_disk_description    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tf_system_disk_description"')]),s._v("\n  image_id                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"centos_7_5_x64_20G_alibase_20211130.vhd"')]),s._v("\n  instance_name              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mytestecs"')]),s._v("\n  vswitch_id                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud_vswitch.vsw.id\n  internet_max_bandwidth_out "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  internet_charge_type       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PayByTraffic"')]),s._v("\n  password                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root@123"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   data_disks {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     name        = "disk2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     size        = 20")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     category    = "cloud_efficiency"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     description = "disk2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     encrypted   = true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     kms_key_id  = alicloud_kms_key.key.id")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   }")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h5",{attrs:{id:"resource-dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resource-dns"}},[s._v("#")]),s._v(" Resource-DNS")]),s._v(" "),a("ul",[a("li",[s._v("定义一条DNS解析记录: ZoneName: terraform.chsaos.com; Type: A; Record: demo")]),s._v(" "),a("li",[s._v("完整域名:  terraform.chsaos.com")]),s._v(" "),a("li",[s._v("需要在阿里云"),a("code",[s._v("RAM")]),s._v("给子账号添加"),a("code",[s._v("DNS")]),s._v("的权限")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# alicloud_dns.tf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE A")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  terraform.chsaos.com")]),s._v("\n\nreource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_dns_record"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"record"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chsaos.com"')]),s._v("\n\thost_record "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"terraform"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A"')]),s._v("\n\tvalue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud_instance.myecs.public_ip\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\nterraform validate\nterraform plan\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"五、datasource数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、datasource数据源"}},[s._v("#")]),s._v(" 五、DataSource数据源")]),s._v(" "),a("h5",{attrs:{id:"datasource"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#datasource"}},[s._v("#")]),s._v(" DataSource")]),s._v(" "),a("ul",[a("li",[s._v("datasource提供资源的数据,可以通过参数过滤并供其他模块引用;使用"),a("code",[s._v("data")]),s._v("块声明")]),s._v(" "),a("li",[s._v("https://registry.terraform.io/providers/aliyun/alicloud/latest/docs/data-sources/images")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\ndata "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_images"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"images_ds"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  owners     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system"')]),s._v("\n  name_regex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^centos_7"')]),s._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Available"')]),s._v("\n  os_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux"')]),s._v("\n  architecture "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x86_64"')]),s._v("\n  output_file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./output.json"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"first_image_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${data.alicloud_images.images_ds.images.0.id}")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"六、variable变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、variable变量"}},[s._v("#")]),s._v(" 六、Variable变量")]),s._v(" "),a("h5",{attrs:{id:"variable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable"}},[s._v("#")]),s._v(" Variable")]),s._v(" "),a("ul",[a("li",[s._v("变量允许自定义"),a("code",[s._v("Terraform")]),s._v("模块,而无需更改模块自己的源代码.这可以实现跨不同的"),a("code",[s._v("Terraform")]),s._v("配置共享模块,使用模块可以组合可重用")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("variable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access_key"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvariable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secret_key"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvariable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"region"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("在"),a("code",[s._v("variable.tf")]),s._v("文件中定义变量")]),s._v(" "),a("li",[s._v("在同一个模块的所有变量中必须是唯一的")]),s._v(" "),a("li",[s._v("可以从环境变量或者文本文件中读取")]),s._v(" "),a("li",[a("code",[s._v("Terraform默认读取")]),s._v("terraform.tfvars`")])]),s._v(" "),a("h5",{attrs:{id:"variable可选参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable可选参数"}},[s._v("#")]),s._v(" Variable可选参数")]),s._v(" "),a("ul",[a("li",[s._v("default变量的默认值")]),s._v(" "),a("li",[s._v("type变量的类型")]),s._v(" "),a("li",[s._v("description变量的描述信息")]),s._v(" "),a("li",[s._v("validation定义变量的验证规则")]),s._v(" "),a("li",[s._v("sensitive 限制变量在UI中显示")]),s._v(" "),a("li",[s._v("nullable变零是否为空")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("variable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"region"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" string\n  description "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"region name"')]),s._v("\n  default "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-shanghai"')]),s._v("\n  sensitive "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h5",{attrs:{id:"variable参数类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable参数类型"}},[s._v("#")]),s._v(" Variable参数类型")]),s._v(" "),a("ul",[a("li",[s._v("any")]),s._v(" "),a("li",[s._v("string")]),s._v(" "),a("li",[s._v("number")]),s._v(" "),a("li",[s._v("bool")]),s._v(" "),a("li",[s._v("list("),a("TYPE",[s._v(")")])],1),s._v(" "),a("li",[s._v("set("),a("TYPE",[s._v(")")])],1),s._v(" "),a("li",[s._v("map("),a("TYPE",[s._v(")")])],1),s._v(" "),a("li",[s._v("object({ATTR_NAME = ATTR_TYPE, ...})")]),s._v(" "),a("li",[s._v("tuple(["),a("TYPE",[s._v(", ...])")])],1)]),s._v(" "),a("p",[s._v("Variable-map-DNS")]),s._v(" "),a("ul",[a("li",[s._v("示例: 使用map类型的变量来定义DNS域名;")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## variables.tf")]),s._v("\nvariable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dns_record"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tdescription "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"define dns name"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## terraform.tfvars")]),s._v("\ndns_record "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev.chsaos.com"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stag"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stag.chsaos.com"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod.chsaos.com"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h5",{attrs:{id:"variable-list-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable-list-env"}},[s._v("#")]),s._v(" Variable-list-ENV")]),s._v(" "),a("ul",[a("li",[s._v("示例：使用list类型的变量来定义环境变量表")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## variables.tf")]),s._v("\n\nvariable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"env_list"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tdescription "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deploy env name"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## terraform.tfvars")]),s._v("\nenv_list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stag"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"variable-object-ecs属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable-object-ecs属性"}},[s._v("#")]),s._v(" Variable-object-ECS属性")]),s._v(" "),a("ul",[a("li",[s._v("示例: 使用object类型的变量来定义ECS属性信息")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## variable.tf")]),s._v("\nvariable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs_info"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ecs_image "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" string,ecs_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## terraform.tfvars")]),s._v("\necs_info "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tecs_image "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"centos_7_9_x64_20G_alibase_20220824.vhd"')]),s._v("\n\tecs_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mydemoecs"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"variable的使用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable的使用方式"}},[s._v("#")]),s._v(" Variable的使用方式")]),s._v(" "),a("p",[s._v("在变量声明后,可以使用"),a("code",[s._v("var.VAR_NAME")]),s._v("的方式引用;"),a("code",[s._v("VAR_NAME")]),s._v("即"),a("code",[s._v("variables.tf")]),s._v("定义;")]),s._v(" "),a("ul",[a("li",[s._v("环境变量")]),s._v(" "),a("li",[s._v("terraform.tfvars | terraform.tfvars.json")]),s._v(" "),a("li",[s._v("*.auto.tfvars | *.auto.tfvars.json")]),s._v(" "),a("li",[s._v("命令行 -var | -var-file")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## alicloud_dns.tf")]),s._v("\n\nreource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_dns_record"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"record"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chsaos.com"')]),s._v("\n\thost_record "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.dns_record"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A"')]),s._v("\n\tvalue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_instance.myecs.public_ip"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -var")]),s._v("\nterraform apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"region=cn-shanghai"')]),s._v("\nterraform apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'env_list=["dev","stag"]\'')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"region=cn-shanghai"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -var-file")]),s._v("\nterraform app -var-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev.tfvars"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## env")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" TF_VAR_region "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn-shanghai'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" TF_VAR_env_list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'["dev","stag"]\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h5",{attrs:{id:"variable-locals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#variable-locals"}},[s._v("#")]),s._v(" Variable-locals")]),s._v(" "),a("p",[s._v("局部、本地变量;局部值有助于避免在配置中多次重复想想的值或表达式")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 定义")]),s._v("\nlocals "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tecs_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mydemoecs"')]),s._v("\n\towner "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chsaos"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 引用")]),s._v("\nlocal.ecs_name\nlocal.owner\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"七、output输出变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、output输出变量"}},[s._v("#")]),s._v(" 七、output输出变量")]),s._v(" "),a("h5",{attrs:{id:"output"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#output"}},[s._v("#")]),s._v(" output")]),s._v(" "),a("p",[s._v("output可以打印已定义的变量,并且可以公开信息以供其他"),a("code",[s._v("Terraform")]),s._v("配置使用.输出值类似于编程语言中的返回值.")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## output.tf")]),s._v("\noutput "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev_dns_name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tvalue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud_dns_record.record.host_record\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("运行 terraform plan")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20220914131209520.png",alt:"image-20220914131209520"}})]),s._v(" "),a("h5",{attrs:{id:"output可选参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#output可选参数"}},[s._v("#")]),s._v(" output可选参数")]),s._v(" "),a("ul",[a("li",[s._v("description 变量的描述信息")]),s._v(" "),a("li",[s._v("sensitive 限制变量在UI中显示")]),s._v(" "),a("li",[s._v("depends_on 依赖关系")])]),s._v(" "),a("h5",{attrs:{id:"output-子模块之间的引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#output-子模块之间的引用"}},[s._v("#")]),s._v(" Output-子模块之间的引用")]),s._v(" "),a("p",[s._v("例如: 如果以一个名为ecs_server的子模块,声明了一个名为instance_ip_addr的输出,则可以将该值作为module.ecs_server.instance_ip_addr.")]),s._v(" "),a("p",[s._v("module."),a("MODULE",{attrs:{NAME:""}},[s._v("."),a("OUTPUT",{attrs:{NAME:""}})],1)],1),s._v(" "),a("h4",{attrs:{id:"八、module模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、module模块"}},[s._v("#")]),s._v(" 八、Module模块")]),s._v(" "),a("p",[a("code",[s._v("Terraform")]),s._v("可以更轻松地扩展基础架构并保持其配置整洁.但是,随着基础架构的增长,单个目录变得难以管理.")]),s._v(" "),a("h5",{attrs:{id:"module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module"}},[s._v("#")]),s._v(" Module")]),s._v(" "),a("p",[s._v("假设: 创建多台服务器? 一遍又一遍重复相同的配置代码?")]),s._v(" "),a("p",[s._v("---这就是模块真正有用的地方")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20220914132310922.png",alt:"image-20220914132310922"}})]),s._v(" "),a("h5",{attrs:{id:"module简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module简介"}},[s._v("#")]),s._v(" Module简介")]),s._v(" "),a("p",[a("code",[s._v("terraform")]),s._v("模块是一种可重用现有代码的方法,减少基础设施组件开发的代码量.")]),s._v(" "),a("p",[a("code",[s._v("Terraform")]),s._v("模块是一个或多个"),a("code",[s._v(".tf")]),s._v("文件集合.")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── main.tf\n├── output.tf\n├── README.md\n└── variables.tf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("实际上任何"),a("code",[s._v("Terraform")]),s._v("配置本身已经是一个模块.如果在此目录中运行"),a("code",[s._v("Terraform")]),s._v(",则这些配置文件将被视为根模块")]),s._v(" "),a("h5",{attrs:{id:"module语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module语法"}},[s._v("#")]),s._v(" Module语法")]),s._v(" "),a("p",[s._v("name: 模块的名称,在"),a("code",[s._v("terraform")]),s._v("中可以使用模块名称进行引用")]),s._v(" "),a("p",[s._v("source: 模块代码的路径,本地或者远程的仓库")]),s._v(" "),a("p",[s._v("version: 版本信息")]),s._v(" "),a("p",[s._v("参数信息:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("module "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx.io/your-org/terraform_test_module"')]),s._v("\n\tversion "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),s._v("\n\targument_1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.test_1\n\targument_2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.test_2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h5",{attrs:{id:"module项目实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module项目实践"}},[s._v("#")]),s._v(" Module项目实践")]),s._v(" "),a("blockquote",[a("p",[s._v("项目参考"),a("code",[s._v("youdianzhishi-terraform/terraform-module-example")]),s._v("中的"),a("code",[s._v("/env/dev")])])]),s._v(" "),a("h5",{attrs:{id:"module工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module工作原理"}},[s._v("#")]),s._v(" Module工作原理")]),s._v(" "),a("p",[s._v("远程模块: 存储到根模块的.terraform目录中(修改后,必须get/init).")]),s._v(" "),a("p",[s._v("本地模块: 将通过软连接的方式引用本地的源目录(修改后,无需操作).")]),s._v(" "),a("p",[s._v("使用terraform get下载模块")]),s._v(" "),a("p",[s._v("使用terraform graph查看模块; -module-depath汇总对象;")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20220914144131006.png",alt:"image-20220914144131006"}})]),s._v(" "),a("h5",{attrs:{id:"module调用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module调用方式"}},[s._v("#")]),s._v(" Module调用方式")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("本地文件: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./module_name"')]),s._v("\nTF注册表: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hashicorp/consul/aws"')]),s._v("\nGitHub:\n- http "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/hashicorp/example"')]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git@github.com/hashicop/example.git"')]),s._v("\nbucket:\n通用Git:\n- http "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git::https://example.com/vpc.git"')]),s._v("\n- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git::ssh://username@example.com/storage.git"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"module-输入、输出变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module-输入、输出变量"}},[s._v("#")]),s._v(" Module-输入、输出变量")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Child module instance(ECS)")]),s._v("\n//main.tf\nresource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_instance"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myecs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tvswitch_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var.vsw_id\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n//variables.tf\nvariable "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vsw_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Child module network(VPC)")]),s._v("\n//main.tf\nresource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_vpc"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vpc"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nresource "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alicloud_vswitch"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vsw"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tvpc_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud_vpc.vpc.id\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n//outputs.tf\noutput "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vsw_id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tvalue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alicloud_vswitch.vsw.id\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Root module")]),s._v("\nmodule "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev_ecs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./moduels/ecs"')]),s._v("\n\tinstance_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs_01"')]),s._v("\n\tvsw_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" module.network.vsw_id\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"network"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./module/vpc"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("h5",{attrs:{id:"module实例化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module实例化"}},[s._v("#")]),s._v(" Module实例化")]),s._v(" "),a("p",[s._v("一个模块可以被多次实例化")]),s._v(" "),a("p",[s._v("每个实例定义唯一的名称,指定相同的"),a("code",[s._v("source")]),s._v("来源;")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("module "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev_ecs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./module/ecs"')]),s._v("\n\tinstance_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs_01"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmodule "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod_ecs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./module/ecs"')]),s._v("\n\tinstance_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs_02"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"module模块优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module模块优点"}},[s._v("#")]),s._v(" Module模块优点")]),s._v(" "),a("ul",[a("li",[s._v("1.解决代码重复问题")]),s._v(" "),a("li",[s._v("2.加强代码读性,代码整洁性")]),s._v(" "),a("li",[s._v("3.资源标准化")]),s._v(" "),a("li",[s._v("4.减少认为错误发生频率")])]),s._v(" "),a("h4",{attrs:{id:"九、expressions表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、expressions表达式"}},[s._v("#")]),s._v(" 九、Expressions表达式")]),s._v(" "),a("h5",{attrs:{id:"条件表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件表达式"}},[s._v("#")]),s._v(" 条件表达式")]),s._v(" "),a("blockquote",[a("p",[s._v("condition ? true_val : false_val")])]),s._v(" "),a("ul",[a("li",[s._v("condition 条件(返回值true/false)")]),s._v(" "),a("li",[s._v("true_val 条件为true的值")]),s._v(" "),a("li",[s._v("false_val 条件为false的值")])]),s._v(" "),a("p",[s._v('实例仓库: "youdianzhishi-terraform/terraform-expr-demo"')]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ terraform  plan\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# consle调试界面")]),s._v("\n$ terraform console\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" var.region\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-shanghai"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" var.region "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" ? var.region "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-shanghai"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-shanghai"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h6",{attrs:{id:"demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[s._v("#")]),s._v(" DEMO")]),s._v(" "),a("blockquote",[a("p",[s._v("当region变量存在时"),a("code",[s._v("region = var.region")]),s._v(",反之"),a("code",[s._v('region = "cn-shanghai"')])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("var.region "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" ? var.region "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn-shanghai"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"for表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#for表达式"}},[s._v("#")]),s._v(" for表达式")]),s._v(" "),a("blockquote",[a("p",[s._v("借助for表达式可以对数据进行处理,生成新的数据对象")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("VAR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" OBJECT "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" VAR "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" INDEX,VAR "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" OBJECT: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INDEX}")]),s._v("="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${VAR}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列表遍历(terraform console模式下)")]),s._v("\n$  terraform  console\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("value")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" var.env_name "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${value}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stag"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" index,value "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" var.env_name "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${index}")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${value}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0-dev"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1-test"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2-stag"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3-prod"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# map遍历(terraform console模式下)")]),s._v("\nterraform  console\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" var.dns_record "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${v}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev.app"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod.app"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stag.app"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.app"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k,v "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" var.dns_record "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${k}")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${v}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev:dev.app"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prod:prod.app"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stag:stag.app"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test:test.app"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("h5",{attrs:{id:"splat表达式-动态表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#splat表达式-动态表达式"}},[s._v("#")]),s._v(" splat表达式(动态表达式)")]),s._v(" "),a("p",[s._v("splat表达式提供了一种简洁的方式来表达可以用for表达式执行的常见操作.")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("var.list.*.attr\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 历史书写方式,不推荐")]),s._v("\nvar.list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".attr\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# terraform console模式下")]),s._v("\n$ terraform console\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" var.ecs_spec\ntolist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  tomap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs01"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs.n1.tiny"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  tomap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"101"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs02"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ecs.n1.tiny"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" var.ecs_spec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".id\ntolist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"101"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h4",{attrs:{id:"十、functions内置函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十、functions内置函数"}},[s._v("#")]),s._v(" 十、Functions内置函数")]),s._v(" "),a("h5",{attrs:{id:"函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[s._v("#")]),s._v(" 函数")]),s._v(" "),a("p",[a("code",[s._v("Terraform")]),s._v("语言包括许多内置函数,可以从表达式中调用这些函数来转换.")]),s._v(" "),a("p",[s._v("函数调用的一般语法是函数名后跟括号以逗号分离的参数.")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arg1,arg2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# terraform console模式下")]),s._v("\n$ terraform console\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" min"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"数值函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数值函数"}},[s._v("#")]),s._v(" 数值函数")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("max() 获取最大值")])]),s._v(" "),a("li",[a("p",[s._v("min() 获取最小值")])]),s._v(" "),a("li",[a("p",[s._v("...将集合扩展为单个参数")])]),s._v(" "),a("li",[a("p",[s._v("parseint() 将字符串解析为整数")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3,4,5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3,4,5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3,4,5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3,4,5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nparseint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"101"')]),s._v(",10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" parseint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v(",10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转成十进制数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" parseint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v(",2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转成二进制数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"string字符串函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#string字符串函数"}},[s._v("#")]),s._v(" String字符串函数")]),s._v(" "),a("ul",[a("li",[s._v("format() 格式化")]),s._v(" "),a("li",[s._v("split() 字符串分割")]),s._v(" "),a("li",[s._v("join()字符串拼接")]),s._v(" "),a("li",[s._v("replace()替换字符串")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello %s!"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"terraform"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\njoin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nreplace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a=b=c"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsplit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name,age,title"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h5",{attrs:{id:"collection集合函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#collection集合函数"}},[s._v("#")]),s._v(" Collection集合函数")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("函数")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("功能")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("alltrue() anytrue()")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("判断元素中都是、存在true")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("chunklist(list,size)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("按照指定size拆分list")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("compat(list)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("去除list中的空元素")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("concat(list1,list2)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("合并两个list")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("contains(list,value)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("判断元素是否存在list中")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("distinct(list)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("去除list中的重复元素")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("element(list,index)   list[index]")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("根据index获取list中的元素")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("flatten(list,list,list)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("将多层list转换成单list")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("index(list,value)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("返回value元素的index")])])])]),s._v(" "),a("h5",{attrs:{id:"map映射函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#map映射函数"}},[s._v("#")]),s._v(" Map映射函数")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("函数")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("功能")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("length(list)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("计算map的长度")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("lookup(map,key,default)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("检索map的key,不存在返回default")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("merge(map1,map2,map3)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("合并map,相同key会被最后覆盖")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("keys(map) values(map)")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("创建map中key的list  创建map中value的list")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);