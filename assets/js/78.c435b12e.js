(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{412:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"argo-rollouts"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#argo-rollouts"}},[s._v("#")]),s._v(" "),n("code",[s._v("Argo Rollouts")])]),s._v(" "),n("p",[n("code",[s._v("Argo Rollout")]),s._v("是一个"),n("code",[s._v("Kubernetes Controller")]),s._v("和对应一系列的"),n("code",[s._v("CRD")]),s._v(",提供更强大的"),n("code",[s._v("Deployment")]),s._v("能力.包括灰度发布、蓝绿部署、更新测试(experimentation)、渐进式交付(progressive delivery)等特性.")]),s._v(" "),n("h5",{attrs:{id:"支持特性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支持特性"}},[s._v("#")]),s._v(" 支持特性")]),s._v(" "),n("ul",[n("li",[s._v("蓝绿发布更新策略")]),s._v(" "),n("li",[s._v("金丝雀更新策略")]),s._v(" "),n("li",[s._v("细粒度,加权流量转移")]),s._v(" "),n("li",[s._v("自动回滚"),n("code",[s._v("Rollback")]),s._v("和"),n("code",[s._v("promotion")])]),s._v(" "),n("li",[s._v("手动判断")]),s._v(" "),n("li",[s._v("可定制的指标查询和业务"),n("code",[s._v("KPI")]),s._v("分析")]),s._v(" "),n("li",[s._v("入口控制器集成: "),n("code",[s._v("NGINX、ALB")])]),s._v(" "),n("li",[s._v("服务网格集成: "),n("code",[s._v("Istio、Linked、SMI")])]),s._v(" "),n("li",[n("code",[s._v("Metric provider")]),s._v("集成: "),n("code",[s._v("Prometheus、Wavefront、Kayenta、Web、Kubernetes Jobs")])])]),s._v(" "),n("p",[n("code",[s._v("Argo")]),s._v("原理和"),n("code",[s._v("Deployment")]),s._v("类似,"),n("code",[s._v("Argo")]),s._v("是加强"),n("code",[s._v("Rollout")]),s._v("的策略和流量控制.当"),n("code",[s._v("spec.template")]),s._v("发送变化时,"),n("code",[s._v("Argo-Rollout")]),s._v("会根据"),n("code",[s._v("spec.strategy")]),s._v("进行"),n("code",[s._v("rollout")]),s._v(",通常会产生一个新的"),n("code",[s._v("ReplicaSet")]),s._v(",逐步"),n("code",[s._v("scale down")]),s._v("之前的"),n("code",[s._v("ReplicaSet")]),s._v("的"),n("code",[s._v("pod")]),s._v("数量.")]),s._v(" "),n("h3",{attrs:{id:"argo-rollout安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#argo-rollout安装"}},[s._v("#")]),s._v(" "),n("code",[s._v("Argo Rollout")]),s._v("安装")]),s._v(" "),n("blockquote",[n("p",[s._v("官方文档: https://argoproj.github.io/argo-rollouts/installation/#kubectl-plugin-installation")])]),s._v(" "),n("h5",{attrs:{id:"_1-kubernetes安装argo-rollouts"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-kubernetes安装argo-rollouts"}},[s._v("#")]),s._v(" 1."),n("code",[s._v("Kubernetes")]),s._v("安装"),n("code",[s._v("argo-rollouts")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在线安装")]),s._v("\nkubectl create namespace argo-rollouts\nkubectl apply "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" https://github.com/argoproj/argo-rollouts/releases/latest/download/install.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定离线文档安装")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-LO")]),s._v(" https://github.com/argoproj/argo-rollouts/releases/latest/download/install.yaml\nkubectl create namespace argo-rollouts\nkubectl apply "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" install.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看`argo-rollouts` pod信息")]),s._v("\nkubectl get pods "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-owide")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h5",{attrs:{id:"_2-安装argo-rollouts插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装argo-rollouts插件"}},[s._v("#")]),s._v(" 2.安装"),n("code",[s._v("argo-rollouts")]),s._v("插件")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装`argo-rollouts`插件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-LO")]),s._v(" https://github.com/argoproj/argo-rollouts/releases/download/v1.3.1/kubectl-argo-rollouts-linux-amd64\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x kubectl-argo-rollouts-linux-amd64\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rp")]),s._v(" kubectl-argo-rollouts-linux-amd64  /usr/bin/kubectl-argo-rollouts\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证插件是否安装成功")]),s._v("\n$ kubectl argo rollouts version\nkubectl-argo-rollouts: v1.3.1+b0b95ca\n  BuildDate: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-09-29T15:17:17Z\n  GitCommit: b0b95cade830d8a70624fcaaf8e92e1fe2ecd355\n  GitTreeState: clean\n  GoVersion: go1.18.6\n  Compiler: gc\n  Platform: linux/amd64\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"金丝雀发布"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#金丝雀发布"}},[s._v("#")]),s._v(" 金丝雀发布")]),s._v(" "),n("ul",[n("li",[s._v("恢复发布包含如下:\n"),n("ul",[n("li",[n("code",[s._v("Replica Shifting")]),s._v(": 版本替换")]),s._v(" "),n("li",[n("code",[s._v("Traffic Shifting")]),s._v(": 流量控制")])])])]),s._v(" "),n("h4",{attrs:{id:"官方demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官方demo"}},[s._v("#")]),s._v(" 官方"),n("code",[s._v("Demo")])]),s._v(" "),n("blockquote",[n("p",[s._v("https://argoproj.github.io/argo-rollouts/getting-started/")])]),s._v(" "),n("h4",{attrs:{id:"replica-shifting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#replica-shifting"}},[s._v("#")]),s._v(" "),n("code",[s._v("Replica Shifting")])]),s._v(" "),n("h5",{attrs:{id:"部署应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署应用"}},[s._v("#")]),s._v(" 部署应用")]),s._v(" "),n("blockquote",[n("p",[s._v("应用部署项目路径: "),n("code",[s._v("kubernetes-software-yaml/argo-rollouts/basic")])])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/argoproj/argo-rollouts.git /root/argo-rollouts\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rp")]),s._v(" /root/argo-rollouts/docs/getting-started/basic /home/kubernetes-software-yaml/argo-rollouts/\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts/basic\n$ tree  ./\n./\n├── rollout.yaml\n└── service.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" directories, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" files\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看`rollouts.yaml`文件内容")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" rollout.yaml \napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: rollouts-demo\nspec:\n  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  strategy:\n    canary:\n      steps:\n      - setWeight: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n      - pause: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n      - pause: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n      - pause: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      - pause: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  revisionHistoryLimit: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  selector:\n    matchLabels:\n      app: rollouts-demo\n  template:\n    metadata:\n      labels:\n        app: rollouts-demo\n    spec:\n      containers:\n      - name: rollouts-demo\n        image: argoproj/rollouts-demo:blue\n        ports:\n        - name: http\n          containerPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          protocol: TCP\n        resources:\n          requests:\n            memory: 32Mi\n            cpu: 5m\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("apiVersion、Kind")]),s._v("和"),n("code",[s._v("Deployment")]),s._v("相同;"),n("code",[s._v("strategy")]),s._v("字段定义的是发布策略:\n"),n("ul",[n("li",[n("code",[s._v("setWeight")]),s._v(": 设置流量的权重")]),s._v(" "),n("li",[n("code",[s._v("pause")]),s._v(": 暂停,如果没有跟"),n("code",[s._v("duration: 10")]),s._v("则表示需要手动更新,如果跟了表示等待多长时间会自动更新.")])])])]),s._v(" "),n("p",[n("code",[s._v("service.yaml")]),s._v("和"),n("code",[s._v("rollout-ingress.yaml")]),s._v("文件内容")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" service.yaml\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: rollouts-demo\nspec:\n  ports:\n  - port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    targetPort: http\n    protocol: TCP\n    name: http\n  selector:\n    app: rollouts-demo\n    \n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" rollout-ingress.yaml\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: my-rollout\n  annotations:\n    kubernetes.io/ingress.class: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n    nginx.ingress.kubernetes.io/ssl-redirect: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\nspec:\n  rules:\n  - host: rolloutdemo.chsaos.com\n    http:\n      paths:\n      - pathType: Prefix\n        path: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        backend:\n          service:\n            name: rollouts-demo\n            port:\n              number: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  tls:\n  - hosts: \n    - rolloutdemo.chsaos.com\n    secretName: jenkins-tls\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("p",[s._v("部署"),n("code",[s._v("argo rollouts")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ kubectl apply "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" rollout.yaml  "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" service.yaml  "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" rollout-ingress.yaml  --dry-run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server\nrollout.argoproj.io/rollouts-demo created "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nservice/rollouts-demo created "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ningress.networking.k8s.io/my-rollout created "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server dry run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n$ kubectl apply "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" rollout.yaml  "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" service.yaml  "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" rollout-ingress.yaml\n\n$ kubectl get pods,svc\nNAME                                          READY   STATUS    RESTARTS      AGE\npod/my-nginx-64cc7f8db7-xqfk7                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("22h ago"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   3d5h\npod/nfs-client-provisioner-66855d4df9-gt9jw   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("             22h\npod/rollouts-demo-687d76d795-648vw            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m35s\npod/rollouts-demo-687d76d795-74b75            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m35s\npod/rollouts-demo-687d76d795-r8hqr            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m35s\npod/rollouts-demo-687d76d795-ww5n2            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m35s\npod/rollouts-demo-687d76d795-z4vqj            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m35s\n\nNAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nservice/kubernetes\tClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   3d5h\nservice/my-nginx        ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.111")]),s._v(".141.0     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    3d5h\nservice/rollouts-demo   ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),s._v(".242.183   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    3m35s\n\n$ kubectl get ingress \nNAME         CLASS    HOSTS                    ADDRESS   PORTS     AGE\nmy-rollout   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   rolloutdemo.chsaos.com             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   4m6s\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看部署状态")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-demo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-demo\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✔ Healthy\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS     AGE    INFO\n⟳ rollouts-demo                            Rollout     ✔ Healthy  5m23s  \n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                          ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  5m23s  stable\n      ├──□ rollouts-demo-687d76d795-648vw  Pod         ✔ Running  5m23s  ready:1/1\n      ├──□ rollouts-demo-687d76d795-74b75  Pod         ✔ Running  5m23s  ready:1/1\n      ├──□ rollouts-demo-687d76d795-r8hqr  Pod         ✔ Running  5m23s  ready:1/1\n      ├──□ rollouts-demo-687d76d795-ww5n2  Pod         ✔ Running  5m23s  ready:1/1\n      └──□ rollouts-demo-687d76d795-z4vqj  Pod         ✔ Running  5m23s  ready:1/1\n\n$ kubectl-argo-rollouts get rollout rollouts-demo\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✔ Healthy\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS     AGE   INFO\n⟳ rollouts-demo                            Rollout     ✔ Healthy  6m2s  \n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                         ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  6m2s  stable\n      ├──□ rollouts-demo-687d76d795-648vw  Pod         ✔ Running  6m2s  ready:1/1\n      ├──□ rollouts-demo-687d76d795-74b75  Pod         ✔ Running  6m2s  ready:1/1\n      ├──□ rollouts-demo-687d76d795-r8hqr  Pod         ✔ Running  6m2s  ready:1/1\n      ├──□ rollouts-demo-687d76d795-ww5n2  Pod         ✔ Running  6m2s  ready:1/1\n      └──□ rollouts-demo-687d76d795-z4vqj  Pod         ✔ Running  6m2s  ready:1/1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br")])]),n("ul",[n("li",[s._v("看到版本被标记为"),n("code",[s._v("stable")]),s._v(",而且"),n("code",[s._v("STATUS")]),s._v("为"),n("code",[s._v("healthy")]),s._v(".可以在末尾添加"),n("code",[s._v("--watch")]),s._v("来实时监控服务状态\n"),n("ul",[n("li",[s._v("完整命令: "),n("code",[s._v("kubectl get rollouts get rollout rollouts-demo --watch")])])])])]),s._v(" "),n("h5",{attrs:{id:"域名访问rollouts-demo服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#域名访问rollouts-demo服务"}},[s._v("#")]),s._v(" 域名访问"),n("code",[s._v("rollouts-demo")]),s._v("服务")]),s._v(" "),n("ul",[n("li",[s._v("https://rolloutdemo.chsaos.com/")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119163337862.png",alt:"image-20221119163337862"}})]),s._v(" "),n("h5",{attrs:{id:"更新应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新应用"}},[s._v("#")]),s._v(" 更新应用")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# argo rollouts 更新镜像`set image`")]),s._v("\n$ kubectl argo rollouts "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image rollouts-demo rollouts-demo"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("argoproj/rollouts-demo:yellow\nrollout "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollouts-demo"')]),s._v(" image updated\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过`--watch`实时观察服务状态")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ◌ Progressing\nMessage:         "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" replicas need to be updated\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\nNAME                                       KIND        STATUS               AGE  INFO\n⟳ rollouts-demo                            Rollout     ◌ Progressing        23m  \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                                  ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ◌ Progressing        6s   canary\n│     └──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ◌ ContainerCreating  6s   ready:0/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                                  ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy            23m  stable\n      ├──□ rollouts-demo-687d76d795-648vw  Pod         ✔ Running            23m  ready:1/1\n      ├──□ rollouts-demo-687d76d795-74b75  Pod         ✔ Running            23m  ready:1/1\n      ├──□ rollouts-demo-687d76d795-r8hqr  Pod         ✔ Running            23m  ready:1/1\n      ├──□ rollouts-demo-687d76d795-ww5n2  Pod         ✔ Running            23m  ready:1/1\n      └──□ rollouts-demo-687d76d795-z4vqj  Pod         ◌ Terminating        23m  ready:1/1\n\n\nName:            rollouts-demo\nNamespace:       default\nStatus:          ॥ Paused\nMessage:         CanaryPauseStep\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS     AGE    INFO\n⟳ rollouts-demo                            Rollout     ॥ Paused   27m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                          ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy  4m51s  canary\n│     └──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running  4m51s  ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                          ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  27m    stable\n      ├──□ rollouts-demo-687d76d795-648vw  Pod         ✔ Running  27m    ready:1/1\n      ├──□ rollouts-demo-687d76d795-74b75  Pod         ✔ Running  27m    ready:1/1\n      ├──□ rollouts-demo-687d76d795-r8hqr  Pod         ✔ Running  27m    ready:1/1\n      └──□ rollouts-demo-687d76d795-ww5n2  Pod         ✔ Running  27m    ready:1/1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("此时多了一个"),n("code",[s._v("version:2")]),s._v(",而且版本标记为"),n("code",[s._v("canary")]),s._v(",状态是"),n("code",[s._v("Status: Paused")]),s._v(","),n("code",[s._v("canary")]),s._v("计入流量为"),n("code",[s._v("20%")])])]),s._v(" "),n("li",[n("p",[s._v("部署之所以处于"),n("code",[s._v("Paused")]),s._v("阶段,是因为在"),n("code",[s._v("rollouts.yaml")]),s._v("中定义了发布一个版本后会暂停,这时候需要手动接入接下来的更新.")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("argo rollouts")]),s._v("提供了"),n("code",[s._v("promote")]),s._v("来进行后续的更新")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ kubectl argo rollouts promote rollouts-demo\nrollout "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rollouts-demo'")]),s._v(" promoted\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次查看`--watch`的状态")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ◌ Progressing\nMessage:         "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" replicas need to be updated\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\nNAME                                       KIND        STATUS               AGE   INFO\n⟳ rollouts-demo                            Rollout     ◌ Progressing        31m   \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                                   ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ◌ Progressing        8m1s  canary\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running            8m1s  ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ◌ ContainerCreating  5s    ready:0/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                                   ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy            31m   stable\n      ├──□ rollouts-demo-687d76d795-648vw  Pod         ✔ Running            31m   ready:1/1\n      ├──□ rollouts-demo-687d76d795-74b75  Pod         ◌ Terminating        31m   ready:1/1\n      ├──□ rollouts-demo-687d76d795-r8hqr  Pod         ✔ Running            31m   ready:1/1\n      └──□ rollouts-demo-687d76d795-ww5n2  Pod         ✔ Running            31m   ready:1/1\n\n\nName:            rollouts-demo\nNamespace:       default\nStatus:          ◌ Progressing\nMessage:         "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" replicas need to be updated\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\nNAME                                       KIND        STATUS               AGE    INFO\n⟳ rollouts-demo                            Rollout     ◌ Progressing        31m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                                    ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ◌ Progressing        8m55s  canary\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running            8m55s  ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running            59s    ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ◌ ContainerCreating  32s    ready:0/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                                    ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy            31m    stable\n      ├──□ rollouts-demo-687d76d795-648vw  Pod         ✔ Running            31m    ready:1/1\n      └──□ rollouts-demo-687d76d795-r8hqr  Pod         ✔ Running            31m    ready:1/1\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后续的更新在`pause`阶段只暂停`10s`,所以会依次自动更新完,不需要手动介入.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到第一个版本已经下线,第二个版本的状态为`Healthy`,且镜像标记为`stable`")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✔ Healthy\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nImages:          argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS        AGE    INFO\n⟳ rollouts-demo                            Rollout     ✔ Healthy     33m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy     10m    stable\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running     10m    ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running     2m56s  ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running     2m29s  ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running     91s    ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-ggqb7  Pod         ✔ Running     81s    ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                             ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  • ScaledDown  33m \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br")])])])]),s._v(" "),n("h5",{attrs:{id:"终止更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#终止更新"}},[s._v("#")]),s._v(" 终止更新")]),s._v(" "),n("ul",[n("li",[s._v("在更新应用过程中,最新的应用有问题,终止更新操作")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ kubectl argo rollouts "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image rollouts-demo rollouts-demo"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("argoproj/rollouts-demo:red\nrollout "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollouts-demo"')]),s._v(" image updated\n\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nStatus:          ◌ Progressing\nMessage:         "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" replicas need to be updated\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nImages:          argoproj/rolloutes-demo:red "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\nNAME                                       KIND        STATUS               AGE    INFO\n⟳ rollouts-demo                            Rollout     ◌ Progressing        41m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:3                                                                    ")]),s._v("\n│  └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  ◌ Progressing        6s     canary\n│     └──□ rollouts-demo-6bd8dd6c77-6726x  Pod         ◌ ContainerCreating  6s     ready:0/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                                    ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy            18m    stable\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running            18m    ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running            10m    ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running            9m39s  ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running            8m41s  ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-ggqb7  Pod         ◌ Terminating        8m31s  ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                                    ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  • ScaledDown         41m    \n\nName:            rollouts-demo\nNamespace:       default\nStatus:          ॥ Paused\nMessage:         CanaryPauseStep\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nImages:          argoproj/rollouts-demo:red "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS        AGE   INFO\n⟳ rollouts-demo                            Rollout     ॥ Paused      43m   \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:4                                                            ")]),s._v("\n│  └──⧉ rollouts-demo-5747959bdb           ReplicaSet  ✔ Healthy     61s   canary\n│     └──□ rollouts-demo-5747959bdb-5mbhp  Pod         ✔ Running     61s   ready:1/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:3                                                            ")]),s._v("\n│  └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  • ScaledDown  2m5s  \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                            ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy     20m   stable\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running     20m   ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running     12m   ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running     11m   ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running     10m   ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                            ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  • ScaledDown  43m \n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新动作会在第一次更新的时候处于`Paused`状态,可以用`abort`来终止发布")]),s._v("\n$ kubectl argo rollouts abort rollouts-demo\nrollout "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rollouts-demo'")]),s._v(" aborted\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次通过`--watch`观察部署状态")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✖ Degraded\nMessage:         RolloutAborted: Rollout aborted update to revision "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nImages:          argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 可以可以看到`Status`是`Degraded`状态而非`Healthy`状态,有必要将其变成`Healthy`状态.")]),s._v("\nNAME                                       KIND        STATUS         AGE   INFO\n⟳ rollouts-demo                            Rollout     ✖ Degraded     44m   \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:4                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-5747959bdb           ReplicaSet  • ScaledDown   2m    canary\n│     └──□ rollouts-demo-5747959bdb-5mbhp  Pod         ◌ Terminating  2m    ready:1/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:3                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  • ScaledDown   3m4s  \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy      21m   stable\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running      21m   ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running      13m   ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running      12m   ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running      11m   ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-wrz2v  Pod         ✔ Running      9s    ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                             ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  • ScaledDown   44m   \n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新发布一下版本")]),s._v("\n$ kubectl argo rollouts "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image rollouts-demo rollouts-demo"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("argoproj/rollouts-demo:yellow\nrollout "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollouts-demo"')]),s._v(" image updated\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 可以看到其状态立即变成Healthy,并且没有创建新的副本、新的版本")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✔ Healthy\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nImages:          argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS        AGE    INFO\n⟳ rollouts-demo                            Rollout     ✔ Healthy     48m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:5                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy     25m    stable\n│     ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running     25m    ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running     17m    ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running     17m    ready:1/1\n│     ├──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running     16m    ready:1/1\n│     └──□ rollouts-demo-6cf78c66c5-wrz2v  Pod         ✔ Running     4m49s  ready:1/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:4                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-5747959bdb           ReplicaSet  • ScaledDown  6m40s  \n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:3                                                             ")]),s._v("\n   └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  • ScaledDown  7m44s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br")])]),n("h5",{attrs:{id:"回退应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#回退应用"}},[s._v("#")]),s._v(" 回退应用")]),s._v(" "),n("ul",[n("li",[s._v("当应用上限后,有些BUG并没有发现,回退操作\n"),n("ul",[n("li",[s._v("执行"),n("code",[s._v("argo rollouts")]),s._v(" "),n("code",[s._v("undo")]),s._v("命令")])])])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里没有处理好`argo rollouts`历史版本的保留记录.")]),s._v("\n$ kubectl-argo-rollouts undo rollouts-demo --to-reversion"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `--watch`观察部署状态")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\n      └──□ rollouts-demo-6cf78c66c5-nxfql  Pod         ◌ Terminating  28s  ready:1/1\nName:            rollouts-demo\nNamespace:       default\nStatus:          ॥ Paused\nMessage:         CanaryPauseStep\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nImages:          argoproj/rollouts-demo:red "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS         AGE  INFO\n⟳ rollouts-demo                            Rollout     ॥ Paused       56m  \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:7                                                            ")]),s._v("\n│  └──⧉ rollouts-demo-5747959bdb           ReplicaSet  ✔ Healthy      14m  canary\n│     └──□ rollouts-demo-5747959bdb-dh974  Pod         ✔ Running      8s   ready:1/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:6                                                            ")]),s._v("\n│  └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  • ScaledDown   16m  \n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:5                                                            ")]),s._v("\n   └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy      33m  stable\n      ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ✔ Running      33m  ready:1/1\n      ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running      26m  ready:1/1\n      ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running      25m  ready:1/1\n      ├──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running      24m  ready:1/1\n      └──□ rollouts-demo-6cf78c66c5-nxfql  Pod         ◌ Terminating  29s  ready:1/1\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 于暂停状态,执行`promote`命令继续后续的更新")]),s._v("\n$ kubectl argo rollouts promote rollouts-demo\n\n\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ◌ Progressing\nMessage:         "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" replicas need to be updated\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\nNAME                                       KIND        STATUS               AGE    INFO\n⟳ rollouts-demo                            Rollout     ◌ Progressing        59m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:7                                                                    ")]),s._v("\n│  └──⧉ rollouts-demo-5747959bdb           ReplicaSet  ◌ Progressing        17m    canary\n│     ├──□ rollouts-demo-5747959bdb-dh974  Pod         ✔ Running            2m33s  ready:1/1\n│     └──□ rollouts-demo-5747959bdb-f4z2n  Pod         ◌ ContainerCreating  5s     ready:0/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:6                                                                    ")]),s._v("\n│  └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  • ScaledDown         18m    \n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:5                                                                    ")]),s._v("\n   └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy            36m    stable\n      ├──□ rollouts-demo-6cf78c66c5-hs5rd  Pod         ◌ Terminating        36m    ready:1/1\n      ├──□ rollouts-demo-6cf78c66c5-zbr84  Pod         ✔ Running            28m    ready:1/1\n      ├──□ rollouts-demo-6cf78c66c5-6xmzp  Pod         ✔ Running            27m    ready:1/1\n      └──□ rollouts-demo-6cf78c66c5-qqlbf  Pod         ✔ Running            27m    ready:1/1\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从`Images`可以看到应用被回退到最初版本为`blue`镜像了")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✔ Healthy\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("/8\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\nNAME                                       KIND        STATUS        AGE    INFO\n⟳ rollouts-demo                            Rollout     ✔ Healthy     62m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:7                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-5747959bdb           ReplicaSet  ✔ Healthy     20m    stable\n│     ├──□ rollouts-demo-5747959bdb-dh974  Pod         ✔ Running     5m20s  ready:1/1\n│     ├──□ rollouts-demo-5747959bdb-f4z2n  Pod         ✔ Running     2m52s  ready:1/1\n│     ├──□ rollouts-demo-5747959bdb-kjvn8  Pod         ✔ Running     2m13s  ready:1/1\n│     ├──□ rollouts-demo-5747959bdb-2qtns  Pod         ✔ Running     99s    ready:1/1\n│     └──□ rollouts-demo-5747959bdb-t87ld  Pod         ✔ Running     88s    ready:1/1\n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:6                                                             ")]),s._v("\n│  └──⧉ rollouts-demo-6bd8dd6c77           ReplicaSet  • ScaledDown  21m    \n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:5                                                             ")]),s._v("\n   └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  • ScaledDown  39m \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br")])]),n("h4",{attrs:{id:"traffic-shifting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#traffic-shifting"}},[s._v("#")]),s._v(" "),n("code",[s._v("Traffic Shifting")])]),s._v(" "),n("ul",[n("li",[s._v("上面没有接入外部流量,仅在内部使用了金丝雀部署过程.这里来接入外部流量进行测试")]),s._v(" "),n("li",[n("code",[s._v("Argo-Rollout")]),s._v("主要集成了"),n("code",[s._v("Ingress")]),s._v("和"),n("code",[s._v("ServiceMesh")]),s._v("两种流量控制方法.")]),s._v(" "),n("li",[s._v("目前"),n("code",[s._v("Ingress")]),s._v("支持"),n("code",[s._v("ALB")]),s._v("和"),n("code",[s._v("NGINX Ingress")]),s._v("(这里使用的是nginx ingress)")])]),s._v(" "),n("h5",{attrs:{id:"应用部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用部署"}},[s._v("#")]),s._v(" 应用部署")]),s._v(" "),n("blockquote",[n("p",[s._v("应用部署项目路径: "),n("code",[s._v("kubernetes-software-yaml/argo-rollouts/nginx")])])]),s._v(" "),n("h6",{attrs:{id:"编排文件内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编排文件内容"}},[s._v("#")]),s._v(" 编排文件内容")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新部署官方`nginx`的示例")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rp")]),s._v(" /root/argo-rollouts/docs/getting-started/nginx /home/kubernetes-software-yaml/argo-rollouts/\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts/nginx/\n$ tree  ./\n./\n├── index.md\n├── ingress.yaml\n├── paused-rollout-nginx.png\n├── rollout-nginx.png\n├── rollout.yaml\n└── services.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" directories, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" files\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个例子包含1个rollout,2个service,1个ingress")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 内容如下")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" rollout.yaml\napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: rollouts-demo\nspec:\n  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  strategy:\n    canary:\n      canaryService: rollouts-demo-canary\n      stableService: rollouts-demo-stable\n      trafficRouting:\n        nginx:\n          stableIngress: rollouts-demo-stable\n      steps:\n      - setWeight: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n      - pause: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  revisionHistoryLimit: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  selector:\n    matchLabels:\n      app: rollouts-demo\n  template:\n    metadata:\n      labels:\n        app: rollouts-demo\n    spec:\n      containers:\n      - name: rollouts-demo\n        image: argoproj/rollouts-demo:blue\n        ports:\n        - name: http\n          containerPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          protocol: TCP\n        resources:\n          requests:\n            memory: 32Mi\n            cpu: 5m\n\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" services.yaml \napiVersion: v1\nkind: Service\nmetadata:\n  name: rollouts-demo-canary\nspec:\n  ports:\n  - port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    targetPort: http\n    protocol: TCP\n    name: http\n  selector:\n    app: rollouts-demo\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This selector will be updated with the pod-template-hash of the canary ReplicaSet. e.g.:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rollouts-pod-template-hash: 7bf84f9696")]),s._v("\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: rollouts-demo-stable\nspec:\n  ports:\n  - port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    targetPort: http\n    protocol: TCP\n    name: http\n  selector:\n    app: rollouts-demo\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This selector will be updated with the pod-template-hash of the stable ReplicaSet. e.g.:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rollouts-pod-template-hash: 789746c88d")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的`argocd-rollouts-tls`需要提前创建好,详情查看上级目录中的`README.md`文件")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ingress.yaml\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: rollouts-demo-stable\n  annotations:\n    kubernetes.io/ingress.class: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n    nginx.ingress.kubernetes.io/ssl-redirect: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\nspec:\n  rules:\n  - host: rolloutdemo.chsaos.com\n    http:\n      paths:\n      - pathType: Prefix\n        path: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        backend:\n          service:\n            name: rollouts-demo-stable\n            port:\n              number: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  tls:\n  - hosts: \n    - rolloutdemo.chsaos.com\n    secretName: argocd-rollouts-tls\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("services.yaml")]),s._v("文件中"),n("code",[s._v("Rollout")]),s._v("分别用"),n("code",[s._v("canaryService")]),s._v("和"),n("code",[s._v("stableService")]),s._v("来分别定义了应用灰度的"),n("code",[s._v("Service Name(rollouts-demo-canary)")]),s._v("和当前版本的"),n("code",[s._v("Service Name(rollouts-demo-stable)")]),s._v(".且"),n("code",[s._v("rollouts-demo-canary")]),s._v("和"),n("code",[s._v("rollots-demo-stable")]),s._v("的"),n("code",[s._v("service")]),s._v("的内容是一样的."),n("code",[s._v("selector")]),s._v("中暂时没有配置上"),n("code",[s._v("pod-template-hash,Argo-Rollout Controller")]),s._v("会根据实际的"),n("code",[s._v("ReplicaSet hash")]),s._v("来修改该值.")]),s._v(" "),n("li",[s._v("当创建完"),n("code",[s._v("ingress")]),s._v("后,"),n("code",[s._v("Rollout Controller")]),s._v("会根据"),n("code",[s._v("ingress rollouts-demo-stable")]),s._v("内容,自动创建一个"),n("code",[s._v("ingress")]),s._v("用了灰度的流量,名字为"),n("code",[s._v("--canary")]),s._v(",所以就多了一个"),n("code",[s._v("ingress rollouts-demo-rollouts-demo-stable-canary")]),s._v(",将流量导向"),n("code",[s._v("Canary Service(rollouts-demo-canary)")])])]),s._v(" "),n("h6",{attrs:{id:"部署操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署操作"}},[s._v("#")]),s._v(" 部署操作")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先删除`Replica Shifting`示例部署的内容")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts/basic\n$ kubectl delete "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" rollout.yaml "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" service.yaml \nrollout.argoproj.io "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollouts-demo"')]),s._v(" deleted\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollouts-demo"')]),s._v(" deleted\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新部署官方`nginx`的示例")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rp")]),s._v(" /root/argo-rollouts/docs/getting-started/nginx /home/kubernetes-software-yaml/argo-rollouts/\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts/nginx/\n$ tree  ./\n./\n├── index.md\n├── ingress.yaml\n├── paused-rollout-nginx.png\n├── rollout-nginx.png\n├── rollout.yaml\n└── services.yaml\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" directories, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" files\n\n$ kubectl apply "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" rollout.yaml  "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" services.yaml "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ingress.yaml \nrollout.argoproj.io/rollouts-demo created\nservice/rollouts-demo-canary created\nservice/rollouts-demo-stable created\ningress.networking.k8s.io/rollouts-demo-stable created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个例子包含1个rollout,2个service,1个ingress")]),s._v("\n$ kubectl  get pods,svc \nNAME                                          READY   STATUS    RESTARTS      AGE\npod/rollouts-demo-687d76d795-mf9hk            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             20s\n\nNAME                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nservice/kubernetes             ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   3d6h\nservice/rollouts-demo-canary   ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.110")]),s._v(".101.55   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    20s\nservice/rollouts-demo-stable   ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),s._v(".105.92    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    20s\n\n$ kubectl  get ingress\nNAME                                        CLASS    HOSTS                    ADDRESS   PORTS     AGE\nrollouts-demo-rollouts-demo-stable-canary   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   rolloutdemo.chsaos.com             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("        94s\nrollouts-demo-stable                        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   rolloutdemo.chsaos.com             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   94s\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("h6",{attrs:{id:"访问域名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问域名"}},[s._v("#")]),s._v(" 访问域名")]),s._v(" "),n("ul",[n("li",[s._v("https://rolloutdemo.chsaos.com/")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119175950643.png",alt:"image-20221119175950643"}})]),s._v(" "),n("h5",{attrs:{id:"更新应用-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新应用-2"}},[s._v("#")]),s._v(" 更新应用")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新应用")]),s._v("\n$ kubectl argo rollouts "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image rollouts-demo rollouts-demo"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("argoproj/rollouts-demo:yellow\nrollout "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollouts-demo"')]),s._v(" image updated\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 观察更新状态")]),s._v("\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ॥ Paused\nMessage:         CanaryPauseStep\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/2\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nImages:          argoproj/rollouts-demo:blue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("canary"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\nNAME                                       KIND        STATUS     AGE  INFO\n⟳ rollouts-demo                            Rollout     ॥ Paused   27m  \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                        ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy  46s  canary\n│     └──□ rollouts-demo-6cf78c66c5-nhh6c  Pod         ✔ Running  46s  ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                        ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  27m  stable\n      └──□ rollouts-demo-687d76d795-mf9hk  Pod         ✔ Running  27m  ready:1/1\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看`canary`ingress中新增参数信息")]),s._v("\n$ kubectl get ingress\nNAME                                        CLASS    HOSTS                    ADDRESS   PORTS     AGE\nrollouts-demo-rollouts-demo-stable-canary   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   rolloutdemo.chsaos.com             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("        29m\nrollouts-demo-stable                        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   rolloutdemo.chsaos.com             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   29m\n\n$ kubectl get ingress rollouts-demo-rollouts-demo-stable-canary "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-oyaml")]),s._v("\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  annotations:\n    kubernetes.io/ingress.class: nginx\n    nginx.ingress.kubernetes.io/canary: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增参数")]),s._v("\n    nginx.ingress.kubernetes.io/canary-weight: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),s._v("\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增参数")]),s._v("\n  creationTimestamp: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-11-19T09:35:53Z"')]),s._v("\n  generation: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  name: rollouts-demo-rollouts-demo-stable-canary\n  namespace: default\n  ownerReferences:\n  - apiVersion: argoproj.io/v1alpha1\n    blockOwnerDeletion: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    controller: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    kind: Rollout\n    name: rollouts-demo\n    uid: 4584a2c6-79bf-41cb-a68c-87a2a4eabe61\n  resourceVersion: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"597087"')]),s._v("\n  uid: f627c2de-ba67-456d-9601-1e72bfa87c96\nspec:\n  rules:\n  - host: rolloutdemo.chsaos.com\n    http:\n      paths:\n      - backend:\n          service:\n            name: rollouts-demo-canary\n            port:\n              number: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n        path: /\n        pathType: Prefix\nstatus:\n  loadBalancer: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br")])]),n("ul",[n("li",[s._v("通过页面发现此时多出了"),n("code",[s._v("yellow")]),s._v("的图标")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119180842948.png",alt:"image-20221119180842948"}})]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 继续发布")]),s._v("\n$ kubectl argo rollouts promote rollouts-demo\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 终止发布")]),s._v("\n$ kubectl argo rollouts abort rollouts-demo\n\n\n$ kubectl argo rollouts get rollout rollouts-dmeo "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\nName:            rollouts-demo\nNamespace:       default\nStatus:          ✔ Healthy\nStrategy:        Canary\n  Step:          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2\n  SetWeight:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  ActualWeight:  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nImages:          argoproj/rollouts-demo:blue\n                 argoproj/rollouts-demo:yellow "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nReplicas:\n  Desired:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Current:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Updated:       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Ready:         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Available:     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\nNAME                                       KIND        STATUS     AGE    INFO\n⟳ rollouts-demo                            Rollout     ✔ Healthy  34m    \n├──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:2                                                          ")]),s._v("\n│  └──⧉ rollouts-demo-6cf78c66c5           ReplicaSet  ✔ Healthy  7m40s  stable\n│     └──□ rollouts-demo-6cf78c66c5-nhh6c  Pod         ✔ Running  7m40s  ready:1/1\n└──"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# revision:1                                                          ")]),s._v("\n   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  34m    delay:17s\n      └──□ rollouts-demo-687d76d795-mf9hk  Pod         ✔ Running  34m    ready:1/1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h4",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("Argo-Rollout")]),s._v("提供更加强大的"),n("code",[s._v("Deplyment")]),s._v(",包含比较适合运维的"),n("strong",[s._v("金丝雀发布")]),s._v("和"),n("strong",[s._v("蓝绿发布")])]),s._v(" "),n("li",[s._v("例如使用蓝绿发布,仅需要配置"),n("code",[s._v("rollout")]),s._v("如下:")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("apiVersion: argoproj.io/v1alpha1\nkind: Rollout  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署完rollout后就有了这个kind资源,这个资源和deployment类似也是管理你的副本集的,所以不能像deployment那样在k8s界面看见,只能通过kubectl命令行")]),s._v("\nmetadata:\n  name: rollout-bluegreen\n  namespace: rollout-test\nspec:\n  template:\n    spec:\n      terminationGracePeriodSeconds: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n      containers:\n      - resources: "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# {}")]),s._v("\n          requests:\n            cpu: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n            memory: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2Gi"')]),s._v("\n          limits:\n            cpu: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n            memory: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2Gi"')]),s._v("\n        terminationMessagePolicy: File\n        imagePullPolicy: Always\n        name: rollout-bluegreen\n        image: argoproj/rollouts-demo:green "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx:1.17.1")]),s._v("\n      schedulerName: default-scheduler\n      securityContext: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      dnsPolicy: ClusterFirst\n      restartPolicy: Always\n    metadata:\n      labels:\n        app: rollout-bluegreen\n  selector:\n    matchLabels:\n      app: rollout-bluegreen\n  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  strategy:\n    blueGreen:  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 蓝绿启用配置")]),s._v("\n      activeService: rollout-bluegreen-active   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生效的服务,需要自己创建建本代码最下面service资源")]),s._v("\n      previewService: rollout-bluegreen-preview  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置预览服务,同理需要自己创建")]),s._v("\n      autoPromotionEnabled: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否直接切换,如为true,会在新版本变绿后直接切换到对外服务")]),s._v("\n      scaleDownDelayRevisionLimit: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      previewReplicaCount: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新版本的pod数量,设为一个从而控制资源消耗")]),s._v("\n    rollingUpdate:\n      maxUnavailable: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("%\n      maxSurge: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("%\n    type: RollingUpdate\n  revisionHistoryLimit: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  progressDeadlineSeconds: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: rollout-bluegreen-active\n  namespace: rollout-test\nspec:\n  sessionAffinity: None\n  selector:\n    app: rollout-bluegreen\n  ports:\n  - protocol: TCP\n    port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    targetPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n  type: LoadBalancer\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);