(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{413:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"一、argo-rollouts金丝雀发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、argo-rollouts金丝雀发布"}},[s._v("#")]),s._v(" 一、"),a("code",[s._v("Argo Rollouts")]),s._v("金丝雀发布")]),s._v(" "),a("h4",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("ul",[a("li",[s._v("这里是依赖前面的"),a("code",[s._v("Kubernetes + Jenkins + Gillab + Argocd")]),s._v("的环境")])]),s._v(" "),a("h4",{attrs:{id:"功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[s._v("#")]),s._v(" 功能")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Argocd")]),s._v("触发"),a("code",[s._v("CD")]),s._v("速度")]),s._v(" "),a("li",[a("code",[s._v("Argocd Rollouts")]),s._v("金丝雀发布")]),s._v(" "),a("li",[s._v("代码仓库打"),a("code",[s._v("Tag")])])]),s._v(" "),a("h3",{attrs:{id:"二、argocd触发cd速度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、argocd触发cd速度"}},[s._v("#")]),s._v(" 二、"),a("code",[s._v("Argocd")]),s._v("触发"),a("code",[s._v("CD")]),s._v("速度")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("Argo CD")]),s._v("每三分钟轮询一次"),a("code",[s._v("Git")]),s._v("存储库,检测清单的变化;消除轮询带来的延迟,将"),a("code",[s._v("API")]),s._v("服务器配置为接收"),a("code",[s._v("Webhook")]),s._v("事件,"),a("code",[s._v("Argo CD")]),s._v("支持"),a("code",[s._v("Github、GitLab、Bitbucket、Bitbucket Server")]),s._v("和"),a("code",[s._v("Gogs")]),s._v("的"),a("code",[s._v("Git Webhook")]),s._v(".")]),s._v(" "),a("blockquote",[a("p",[s._v("官方参考文档: https://argo-cd.readthedocs.io/en/stable/operator-manual/webhook/#2-configure-argo-cd-with-the-webhook-secret-optional")])])])]),s._v(" "),a("h4",{attrs:{id:"argocd-secret创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#argocd-secret创建"}},[s._v("#")]),s._v(" "),a("code",[s._v("Argocd Secret")]),s._v("创建")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看`Argocd`登录密码")]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd get secret argocd-initial-admin-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.password}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\nFMgfgp1RLZ2HRLbz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建`Argocd`的Secret")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("YWRtaW4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'FMgfgp1RLZ2HRLbz'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Rk1nZmdwMVJMWjJIUkxieg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" -")]),s._v("\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: coolops\n  namespace: argocd\ndata:\n  username: YWRtaW4=\n  password: Rk1nZmdwMVJMWjJIUkxieg==\nEOF")]),s._v("\n\n\n$ kubectl get secrets "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\nNAME                                           TYPE                                  DATA   AGE\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nargocd-secret                                  Opaque                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("      31h\nargocd-server-token-djvdg                      kubernetes.io/service-account-token   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      31h\nargocd-tls                                     kubernetes.io/tls                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      30h\ncoolops                                        Opaque                                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      13s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将创建好的`Secret`添加到`Argocd`的configmap中")]),s._v("\n$ kubectl edit secret argocd-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\napiVersion: v1\ndata:\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n  webhook.gitlab.secret: coolops\nkind: Secret\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n  labels:\n    app.kubernetes.io/name: argocd-secret\n    app.kubernetes.io/part-of: argocd\n  name: argocd-secret\n  namespace: argocd\ntype: Opaque\n\n\n$ kubectl describe secret argocd-secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\nName:         argocd-secret\nNamespace:    argocd\nLabels:       app.kubernetes.io/name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("argocd-secret\n              app.kubernetes.io/part-of"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("argocd\nAnnotations:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nType:  Opaque\n\nData\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\nadmin.password:         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" bytes\nadmin.passwordMtime:    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" bytes\nserver.secretkey:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" bytes\ntls.crt:                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1237")]),s._v(" bytes\ntls.key:                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1679")]),s._v(" bytes\nwebhook.gitlab.secret:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" bytes\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br")])]),a("h4",{attrs:{id:"gitla-webhook配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitla-webhook配置"}},[s._v("#")]),s._v(" "),a("code",[s._v("Gitla WebHook")]),s._v("配置")]),s._v(" "),a("blockquote",[a("p",[s._v("项目仓库名: devops-cd")]),s._v(" "),a("p",[s._v("网址: https://argocddemo.chsaos.com/api/webhook")]),s._v(" "),a("p",[s._v("Secret 令牌: coolops")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119000715944.png",alt:"image-20221119000715944"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119001434374.png",alt:"image-20221119001434374"}})]),s._v(" "),a("ul",[a("li",[s._v("如果不是使用正式域名进行的部署的话;"),a("code",[s._v("Argocd")]),s._v("集群内部证书是无效证书,要把"),a("code",[s._v("Enabled SSL")]),s._v("去掉")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119001459862.png",alt:"image-20221119001459862"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119001533584.png",alt:"image-20221119001533584"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119001553188.png",alt:"image-20221119001553188"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看argocd server日志信息")]),s._v("\n$ kubectl  logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" argocd-server-5b8c45c484-828zw  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argocd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119001929470.png",alt:"image-20221119001929470"}})]),s._v(" "),a("h3",{attrs:{id:"三、argo-rollouts金丝雀发布配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、argo-rollouts金丝雀发布配置"}},[s._v("#")]),s._v(" 三、"),a("code",[s._v("Argo Rollouts")]),s._v("金丝雀发布配置")]),s._v(" "),a("h4",{attrs:{id:"_1-kubernetes集群中部署argo-rollouts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-kubernetes集群中部署argo-rollouts"}},[s._v("#")]),s._v(" 1."),a("code",[s._v("Kubernetes")]),s._v("集群中部署"),a("code",[s._v("argo-rollouts")])]),s._v(" "),a("blockquote",[a("p",[s._v("官方文档:")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定本地文件安装")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts-canary\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-OL")]),s._v(" https://raw.githubusercontent.com/argoproj/argo-rollouts/stable/manifests/install.yaml\n$ kubectl create namespace argo-rollouts\n$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" install.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定在线安装文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts-canary\n$ kubectl create namespace argo-rollouts\n$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" https://raw.githubusercontent.com/argoproj/argo-rollouts/stable/manifests/install.yaml\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务状态")]),s._v("\n$ kubectl get pods,svc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts                                                      Sat Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":22:32 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n\nNAME                                READY   STATUS    RESTARTS   AGE\npod/argo-rollouts-84995876f-bf7s6   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s\n\nNAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    AGE\nservice/argo-rollouts-metrics   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),s._v(".222.41   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v("/TCP   3h49m\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_2-安装argo-rollouts插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装argo-rollouts插件"}},[s._v("#")]),s._v(" 2.安装"),a("code",[s._v("argo-rollouts")]),s._v("插件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-LO")]),s._v(" https://github.com/argoproj/argo-rollouts/releases/download/v1.3.1/kubectl-argo-rollouts-linux-amd64\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./kubectl-argo-rollouts-linux-amd64\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ./kubectl-argo-rollouts-linux-amd64 /usr/bin/kubectl-argo-rollouts\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `kubectl-argo-rollouts`命令使用")]),s._v("\n$ kubectl-argo-rollouts get rollout rollouts-demo\n$ kubectl argo rollouts get rollout rollouts-demo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--watch")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("3.重写"),a("code",[s._v("deployment")]),s._v("文件")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("主要配置清单如下:")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("rollout.yaml、services.yaml、ingress.yaml、kustomization.yaml")]),s._v(";将编排文件保存到如下项目"),a("code",[s._v("devops-cd/rollout-simple-java")]),s._v("路径中")])])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建命名空间")]),s._v("\n$ kubectl create namespace myapp-dev\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建拉取镜像使用的`Secret`")]),s._v("\n$ kubectl create secret docker-registry gitlab-registry --docker-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("harbordemo.chsaos.com --docker-username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin --docker-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Harbor12345 --docker-email"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin@admin.com "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" myapp-dev\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `host IP`版本`YAML`")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" rollout.yaml\n\napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: rollouts-simple-java\n  namespace: myapp-dev\nspec:\n  replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  strategy:\n    canary:\n      canaryService: rollouts-simple-java-canary\n      stableService: rollouts-simple-java-stable\n      trafficRouting:\n        nginx:\n          stableIngress: rollouts-simple-java-stable\n      steps:\n      - setWeight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n      - pause: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n      - pause: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      - pause: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  revisionHistoryLimit: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  selector:\n    matchLabels:\n      app: rollouts-simple-java\n  template:\n    metadata:\n      labels:\n        app: rollouts-simple-java\n    spec:\n      containers:\n        - args:\n            - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v("\n            - /opt/myapp.jar\n            - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--server.port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          command:\n            - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("\n          env:\n            - name: HOST_IP\n              valueFrom:\n                fieldRef:\n                  apiVersion: v1\n                  fieldPath: status.hostIP\n          image: registry.cn-hangzhou.aliyuncs.com/rookieops/myapp:latest\n          imagePullPolicy: IfNotPresent\n          lifecycle:\n            preStop:\n              exec:\n                command:\n                  - /bin/sh\n                  - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v("\n                  - /bin/sleep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n          livenessProbe:\n            failureThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            httpGet:\n              path: /hello\n              port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n              scheme: HTTP\n            initialDelaySeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n            periodSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n            successThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            timeoutSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          name: myapp\n          ports:\n            - containerPort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n              name: http\n              protocol: TCP\n          readinessProbe:\n            failureThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            httpGet:\n              path: /hello\n              port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n              scheme: HTTP\n            periodSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n            successThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            timeoutSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          resources:\n            limits:\n              cpu: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n              memory: 2Gi\n            requests:\n              cpu: 100m\n              memory: 1Gi\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n      dnsPolicy: ClusterFirstWithHostNet\n      imagePullSecrets:\n        - name: gitlab-registry\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `Deployment Service`版本`YAML`")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" rollout.yaml\n---\napiVersion: argoproj.io/v1alpha1\nkind: Rollout\nmetadata:\n  name: rollouts-simple-java  \n  namespace: myapp-dev\nspec:\n  replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  strategy:\n    canary:\n      canaryService: rollouts-simple-java-canary\n      stableService: rollouts-simple-java-stable\n      trafficRouting:\n        nginx:\n          stableIngress: rollouts-simple-java-stable\n      steps:\n      - setWeight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n      - pause: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n      - pause: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      - setWeight: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      - pause: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("duration: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  revisionHistoryLimit: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  selector:\n    matchLabels:\n      app: rollouts-simple-java\n  template:\n    metadata:\n      labels:\n        app: rollouts-simple-java\n    spec:\n      containers:\n        - args:\n            - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v("\n            - /opt/myapp.jar\n            - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--server.port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          command:\n            - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v("\n          image: harbordemo.chsaos.com/rollout-java-project/myapp:latest\n          imagePullPolicy: IfNotPresent\n          lifecycle:\n            preStop:\n              exec:\n                command:\n                  - /bin/sh\n                  - "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v("\n                  - /bin/sleep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n          livenessProbe:\n            failureThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            httpGet:\n              path: /hello\n              port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n              scheme: HTTP\n            initialDelaySeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n            periodSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n            successThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            timeoutSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          name: myapp\n          ports:\n            - containerPort: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n              name: http\n              protocol: TCP\n          readinessProbe:\n            failureThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n            httpGet:\n              path: /hello\n              port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n              scheme: HTTP\n            periodSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n            successThreshold: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            timeoutSeconds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          resources:\n            limits:\n              cpu: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n              memory: 2Gi\n            requests:\n              cpu: 100m\n              memory: 1Gi\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n      imagePullSecrets:\n        - name: gitlab-registry\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `Services.yaml`编排文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" services.yaml\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: rollouts-simple-java-canary\n  namespace: myapp-dev\nspec:\n  ports:\n  - port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n    targetPort: http\n    protocol: TCP\n    name: http\n  selector:\n    app: rollouts-simple-java\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This selector will be updated with the pod-template-hash of the canary ReplicaSet. e.g.:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rollouts-pod-template-hash: 7bf84f9696")]),s._v("\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: rollouts-simple-java-stable\n  namespace: myapp-dev\nspec:\n  ports:\n  - port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n    targetPort: http\n    protocol: TCP\n    name: http\n  selector:\n    app: rollouts-simple-java\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This selector will be updated with the pod-template-hash of the stable ReplicaSet. e.g.:")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rollouts-pod-template-hash: 789746c88d")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `ingress`编排文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ingress.yaml\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: rollouts-simple-java-stable\n  namespace: myapp-dev\n  annotations:\n    kubernetes.io/ingress.class: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n    nginx.ingress.kubernetes.io/ssl-redirect: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\nspec:\n  rules:\n  - host: testrolloutsdemo.chsaos.com\n    http:\n      paths:\n      - pathType: Prefix\n        path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        backend:\n          service:\n            name: rollouts-simple-java-stable\n            port:\n              number: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n  tls:\n  - hosts: \n    - testrolloutsdemo.chsaos.com\n    secretName: testcoolops-tls\n          \n          \n          \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `kustomization.yaml`文件")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kustomization.yaml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example configuration for the webserver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# at https://github.com/monopole/hello")]),s._v("\ncommonLabels:\n  app: rollouts-simple-java\n\nresources:\n- rollout.yaml\n- services.yaml\n- ingress.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nimages:\n- name: harbordemo.chsaos.com/rollout-java-project/myapp\n  newTag: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"latest"')]),s._v("\nnamespace: myapp-dev\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br"),a("span",{staticClass:"line-number"},[s._v("161")]),a("br"),a("span",{staticClass:"line-number"},[s._v("162")]),a("br"),a("span",{staticClass:"line-number"},[s._v("163")]),a("br"),a("span",{staticClass:"line-number"},[s._v("164")]),a("br"),a("span",{staticClass:"line-number"},[s._v("165")]),a("br"),a("span",{staticClass:"line-number"},[s._v("166")]),a("br"),a("span",{staticClass:"line-number"},[s._v("167")]),a("br"),a("span",{staticClass:"line-number"},[s._v("168")]),a("br"),a("span",{staticClass:"line-number"},[s._v("169")]),a("br"),a("span",{staticClass:"line-number"},[s._v("170")]),a("br"),a("span",{staticClass:"line-number"},[s._v("171")]),a("br"),a("span",{staticClass:"line-number"},[s._v("172")]),a("br"),a("span",{staticClass:"line-number"},[s._v("173")]),a("br"),a("span",{staticClass:"line-number"},[s._v("174")]),a("br"),a("span",{staticClass:"line-number"},[s._v("175")]),a("br"),a("span",{staticClass:"line-number"},[s._v("176")]),a("br"),a("span",{staticClass:"line-number"},[s._v("177")]),a("br"),a("span",{staticClass:"line-number"},[s._v("178")]),a("br"),a("span",{staticClass:"line-number"},[s._v("179")]),a("br"),a("span",{staticClass:"line-number"},[s._v("180")]),a("br"),a("span",{staticClass:"line-number"},[s._v("181")]),a("br"),a("span",{staticClass:"line-number"},[s._v("182")]),a("br"),a("span",{staticClass:"line-number"},[s._v("183")]),a("br"),a("span",{staticClass:"line-number"},[s._v("184")]),a("br"),a("span",{staticClass:"line-number"},[s._v("185")]),a("br"),a("span",{staticClass:"line-number"},[s._v("186")]),a("br"),a("span",{staticClass:"line-number"},[s._v("187")]),a("br"),a("span",{staticClass:"line-number"},[s._v("188")]),a("br"),a("span",{staticClass:"line-number"},[s._v("189")]),a("br"),a("span",{staticClass:"line-number"},[s._v("190")]),a("br"),a("span",{staticClass:"line-number"},[s._v("191")]),a("br"),a("span",{staticClass:"line-number"},[s._v("192")]),a("br"),a("span",{staticClass:"line-number"},[s._v("193")]),a("br"),a("span",{staticClass:"line-number"},[s._v("194")]),a("br"),a("span",{staticClass:"line-number"},[s._v("195")]),a("br"),a("span",{staticClass:"line-number"},[s._v("196")]),a("br"),a("span",{staticClass:"line-number"},[s._v("197")]),a("br"),a("span",{staticClass:"line-number"},[s._v("198")]),a("br"),a("span",{staticClass:"line-number"},[s._v("199")]),a("br"),a("span",{staticClass:"line-number"},[s._v("200")]),a("br"),a("span",{staticClass:"line-number"},[s._v("201")]),a("br"),a("span",{staticClass:"line-number"},[s._v("202")]),a("br"),a("span",{staticClass:"line-number"},[s._v("203")]),a("br"),a("span",{staticClass:"line-number"},[s._v("204")]),a("br"),a("span",{staticClass:"line-number"},[s._v("205")]),a("br"),a("span",{staticClass:"line-number"},[s._v("206")]),a("br"),a("span",{staticClass:"line-number"},[s._v("207")]),a("br"),a("span",{staticClass:"line-number"},[s._v("208")]),a("br"),a("span",{staticClass:"line-number"},[s._v("209")]),a("br"),a("span",{staticClass:"line-number"},[s._v("210")]),a("br"),a("span",{staticClass:"line-number"},[s._v("211")]),a("br"),a("span",{staticClass:"line-number"},[s._v("212")]),a("br"),a("span",{staticClass:"line-number"},[s._v("213")]),a("br"),a("span",{staticClass:"line-number"},[s._v("214")]),a("br"),a("span",{staticClass:"line-number"},[s._v("215")]),a("br"),a("span",{staticClass:"line-number"},[s._v("216")]),a("br"),a("span",{staticClass:"line-number"},[s._v("217")]),a("br"),a("span",{staticClass:"line-number"},[s._v("218")]),a("br"),a("span",{staticClass:"line-number"},[s._v("219")]),a("br"),a("span",{staticClass:"line-number"},[s._v("220")]),a("br"),a("span",{staticClass:"line-number"},[s._v("221")]),a("br"),a("span",{staticClass:"line-number"},[s._v("222")]),a("br"),a("span",{staticClass:"line-number"},[s._v("223")]),a("br"),a("span",{staticClass:"line-number"},[s._v("224")]),a("br"),a("span",{staticClass:"line-number"},[s._v("225")]),a("br"),a("span",{staticClass:"line-number"},[s._v("226")]),a("br"),a("span",{staticClass:"line-number"},[s._v("227")]),a("br"),a("span",{staticClass:"line-number"},[s._v("228")]),a("br"),a("span",{staticClass:"line-number"},[s._v("229")]),a("br"),a("span",{staticClass:"line-number"},[s._v("230")]),a("br"),a("span",{staticClass:"line-number"},[s._v("231")]),a("br"),a("span",{staticClass:"line-number"},[s._v("232")]),a("br"),a("span",{staticClass:"line-number"},[s._v("233")]),a("br"),a("span",{staticClass:"line-number"},[s._v("234")]),a("br"),a("span",{staticClass:"line-number"},[s._v("235")]),a("br"),a("span",{staticClass:"line-number"},[s._v("236")]),a("br"),a("span",{staticClass:"line-number"},[s._v("237")]),a("br"),a("span",{staticClass:"line-number"},[s._v("238")]),a("br"),a("span",{staticClass:"line-number"},[s._v("239")]),a("br"),a("span",{staticClass:"line-number"},[s._v("240")]),a("br"),a("span",{staticClass:"line-number"},[s._v("241")]),a("br"),a("span",{staticClass:"line-number"},[s._v("242")]),a("br"),a("span",{staticClass:"line-number"},[s._v("243")]),a("br"),a("span",{staticClass:"line-number"},[s._v("244")]),a("br"),a("span",{staticClass:"line-number"},[s._v("245")]),a("br"),a("span",{staticClass:"line-number"},[s._v("246")]),a("br"),a("span",{staticClass:"line-number"},[s._v("247")]),a("br"),a("span",{staticClass:"line-number"},[s._v("248")]),a("br"),a("span",{staticClass:"line-number"},[s._v("249")]),a("br"),a("span",{staticClass:"line-number"},[s._v("250")]),a("br"),a("span",{staticClass:"line-number"},[s._v("251")]),a("br"),a("span",{staticClass:"line-number"},[s._v("252")]),a("br"),a("span",{staticClass:"line-number"},[s._v("253")]),a("br"),a("span",{staticClass:"line-number"},[s._v("254")]),a("br"),a("span",{staticClass:"line-number"},[s._v("255")]),a("br"),a("span",{staticClass:"line-number"},[s._v("256")]),a("br"),a("span",{staticClass:"line-number"},[s._v("257")]),a("br"),a("span",{staticClass:"line-number"},[s._v("258")]),a("br"),a("span",{staticClass:"line-number"},[s._v("259")]),a("br"),a("span",{staticClass:"line-number"},[s._v("260")]),a("br"),a("span",{staticClass:"line-number"},[s._v("261")]),a("br"),a("span",{staticClass:"line-number"},[s._v("262")]),a("br"),a("span",{staticClass:"line-number"},[s._v("263")]),a("br"),a("span",{staticClass:"line-number"},[s._v("264")]),a("br"),a("span",{staticClass:"line-number"},[s._v("265")]),a("br"),a("span",{staticClass:"line-number"},[s._v("266")]),a("br"),a("span",{staticClass:"line-number"},[s._v("267")]),a("br"),a("span",{staticClass:"line-number"},[s._v("268")]),a("br"),a("span",{staticClass:"line-number"},[s._v("269")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119200632211.png",alt:"image-20221119200632211"}})]),s._v(" "),a("ul",[a("li",[s._v("这里的"),a("strong",[s._v("金丝雀")]),s._v("发布采是带有"),a("strong",[s._v("时间暂停")]),s._v("的方式,才可以手动继续的方式;方便测试.")])]),s._v(" "),a("h3",{attrs:{id:"四、仓库代码tag标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、仓库代码tag标签"}},[s._v("#")]),s._v(" 四、仓库代码"),a("code",[s._v("Tag")]),s._v("标签")]),s._v(" "),a("ul",[a("li",[s._v("当代码仓库经过长时间的迭代,针对不同的时期和需求,必定会有不同的版本.而借助"),a("code",[s._v("Git")]),s._v("提供的标签功能,可以快捷方便地记录代码版本.无论什么时候,想取回某个版本,不再需要查找冗长的"),a("code",[s._v("commit_id")]),s._v(",只需要取出打标签的历史版本即可.")]),s._v(" "),a("li",[a("strong",[s._v("标签是版本的一个快照")]),s._v(".主流的"),a("code",[s._v("Git")]),s._v("平台上,版本可以直接下载的,节省了开发者的时间精力.")]),s._v(" "),a("li",[s._v("通过"),a("code",[s._v("gitlab")]),s._v("的"),a("code",[s._v("api")]),s._v("对代码仓库打"),a("code",[s._v("tag")]),s._v(".\n"),a("ul",[a("li",[a("code",[s._v("API")]),s._v("的具体操作: https://docs.gitlab.com/ee/api/tags.html")])])])]),s._v(" "),a("h4",{attrs:{id:"sharelibrary新增gitlab-groovy文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sharelibrary新增gitlab-groovy文件"}},[s._v("#")]),s._v(" "),a("code",[s._v("shareLibrary")]),s._v("新增"),a("code",[s._v("gitlab.groovy")]),s._v("文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 这里的`${gitServer}`需要在`rollout-java.Jenkinsfile`文件中的`environment`中进行定义")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" gitlab.groovy\n\npackage org.devops\n\n//封装HTTP请求\ndef HttpReq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reqType,reqUrl,reqBody"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    // def gitServer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://172.17.100.135:32080/api/v4"')]),s._v("\n    withCredentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlab-token'")]),s._v(", variable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlabToken'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" httpRequest customHeaders: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("maskValue: true, name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PRIVATE-TOKEN'")]),s._v(", value: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${gitlabToken}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", \n                httpMode: reqType, \n                contentType: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"APPLICATION_JSON"')]),s._v(",\n                consoleLogResponseBody: true,\n                ignoreSslErrors: true, \n                requestBody: reqBody,\n                url: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${gitServer}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${reqUrl}")]),s._v('"')]),s._v("\n                //quiet: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n//获取项目ID\ndef GetProjectID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("projectName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    projectApi "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"projects?search='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectName}")]),s._v('"')]),s._v("\n    response "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" HttpReq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),s._v(",projectApi,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    def result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" readJSON text: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${response.content}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n    \n    '),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("repo "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       // println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path_with_namespace'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectName}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            \n            repoId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("repoId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" repoId\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n// 给仓库打tag\ndef TagGitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("projectId,tag_name,tag_ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    def apiUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"projects/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectId}")]),s._v('/repository/tags"')]),s._v("\n    reqBody "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tag_name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tag_name}")]),s._v('"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ref"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tag_ref}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n    HttpReq'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),s._v(",apiUrl,reqBody"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119202731811.png",alt:"image-20221119202731811"}})]),s._v(" "),a("ul",[a("li",[s._v("通过"),a("code",[s._v("GetProjectID")]),s._v("获取到项目仓库的"),a("code",[s._v("ID")]),s._v(",然后再调用"),a("code",[s._v("TagGitlab")]),s._v("进行打"),a("code",[s._v("Tag")])])]),s._v(" "),a("h4",{attrs:{id:"jenkins创建gitlab-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins创建gitlab-token"}},[s._v("#")]),s._v(" "),a("code",[s._v("Jenkins")]),s._v("创建"),a("code",[s._v("gitlab-token")])]),s._v(" "),a("ul",[a("li",[s._v("在"),a("code",[s._v("Jenkins")]),s._v("上创建一个名叫"),a("code",[s._v("gitlab-token")]),s._v("的token凭据")])]),s._v(" "),a("h5",{attrs:{id:"gitlab生成token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab生成token"}},[s._v("#")]),s._v(" "),a("code",[s._v("GitLab")]),s._v("生成"),a("code",[s._v("Token")])]),s._v(" "),a("blockquote",[a("p",[s._v("Name: rollout-gitlab-token")]),s._v(" "),a("p",[s._v("Access Token: "),a("code",[s._v("yhMif-sy4dHegEr97d4U")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119230538354.png",alt:"image-20221119230538354"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119230604379.png",alt:"image-20221119230604379"}})]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("Linux curl")]),s._v("测试"),a("code",[s._v("GitLab API")]),s._v("接口")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("GitLab")]),s._v("官方文档")]),s._v(" "),a("blockquote",[a("p",[s._v("https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html")]),s._v(" "),a("p",[s._v("https://docs.gitlab.com/ee/api/search.html")])])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PRIVATE-TOKEN: yhMif-sy4dHegEr97d4U"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://gitlabdemo.chsaos.com/api/v4/projects?search=springboot-helloworld"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jq\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3675")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3675")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23099")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" --:--:-- --:--:-- --:--:-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23259")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"description"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"springboot-helloworld"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name_with_namespace"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java / springboot-helloworld"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"springboot-helloworld"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path_with_namespace"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java/springboot-helloworld"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created_at"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-11-16T21:41:52.667+08:00"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default_branch"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tag_list"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topics"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh_url_to_repo"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh://git@gitlabdemo.chsaos.com:30022/java/springboot-helloworld.git"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_url_to_repo"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/java/springboot-helloworld.git"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/java/springboot-helloworld"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"readme_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/java/springboot-helloworld/-/blob/main/README.md"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"avatar_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"forks_count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"star_count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"last_activity_at"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-11-18T21:44:04.641+08:00"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"namespace"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kind"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"full_path"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"parent_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"avatar_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/groups/java"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_links"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"self"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"issues"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/issues"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge_requests"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/merge_requests"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repo_branches"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/repository/branches"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/labels"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"events"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/events"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"members"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/members"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster_agents"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://gitlabdemo.chsaos.com/api/v4/projects/2/cluster_agents"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"empty_repo"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"archived"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"visibility"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"private"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"resolve_outdated_diff_discussions"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"container_expiration_policy"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cadence"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1d"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keep_n"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"older_than"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"90d"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name_regex"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name_regex_keep"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"next_run_at"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-11-17T21:41:52.729+08:00"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"issues_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge_requests_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wiki_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jobs_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"snippets_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"container_registry_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service_desk_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"service_desk_address"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"can_create_merge_request_in"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"issues_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repository_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge_requests_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"forking_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wiki_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"builds_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"snippets_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pages_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"private"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"operations_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"analytics_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"container_registry_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"security_and_compliance_access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"private"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"emails_disabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared_runners_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lfs_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"creator_id"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"import_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"import_type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"import_status"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"open_issues_count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ci_default_git_depth"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ci_forward_deployment_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ci_job_token_scope_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ci_separated_caches"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public_jobs"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_timeout"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auto_cancel_pending_pipelines"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enabled"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_coverage_regex"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ci_config_path"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shared_with_groups"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"only_allow_merge_if_pipeline_succeeds"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"allow_merge_on_skipped_pipeline"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"restrict_user_defined_variables"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"request_access_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"only_allow_merge_if_all_discussions_are_resolved"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remove_source_branch_after_merge"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"printing_merge_request_link_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge_method"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"squash_option"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default_off"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enforce_auth_checks_on_uploads"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"suggestion_commit_message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"merge_commit_template"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"squash_commit_template"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auto_devops_enabled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auto_devops_deploy_strategy"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"continuous"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autoclose_referenced_issues"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repository_storage"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keep_latest_artifact"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runner_token_expiration_interval"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"permissions"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"project_access"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group_access"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"notification_level"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br")])]),a("h5",{attrs:{id:"jenkins添加token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins添加token"}},[s._v("#")]),s._v(" "),a("code",[s._v("Jenkins")]),s._v("添加"),a("code",[s._v("Token")])]),s._v(" "),a("blockquote",[a("p",[s._v("Jenkins上创建凭据 系统管理->凭据管理->全局凭据->添加凭据")]),s._v(" "),a("p",[a("strong",[s._v("这里的"),a("code",[s._v("ID")]),s._v("要和"),a("code",[s._v("gitlab.groovy")]),s._v("中的"),a("code",[s._v("ID")]),s._v("一一对应")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119204446589.png",alt:"image-20221119204446589"}})]),s._v(" "),a("h3",{attrs:{id:"五、argocd中创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、argocd中创建项目"}},[s._v("#")]),s._v(" 五、"),a("code",[s._v("ArgoCD")]),s._v("中创建项目")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("YAML")]),s._v("配置模板")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" rollout-simple-java.yaml\n\napiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rollout-simple-java'")]),s._v("\n  namespace: argocd\nspec:\n  destination:\n    namespace: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),s._v("\n    server: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://kubernetes.default.svc'")]),s._v("\n  source:\n    path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rollout-simple-java/'")]),s._v("\n    repoURL: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://gitlabdemo.chsaos.com/infra/devops-cd.git'")]),s._v("\n    targetRevision: HEAD\n  project: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'default'")]),s._v("\n  syncPolicy:\n    automated: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("UI")]),s._v("界面配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119210109204.png",alt:"image-20221119210109204"}})]),s._v(" "),a("blockquote",[a("p",[s._v("Application Name: rollout-simple-java")]),s._v(" "),a("p",[s._v("Project Name: default")]),s._v(" "),a("p",[s._v("SYNC POLICY: Automatic")]),s._v(" "),a("p",[s._v("SYNC OPTAIONS: PRUNE LAST")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119210223169.png",alt:"image-20221119210223169"}})]),s._v(" "),a("blockquote",[a("p",[s._v("Repository URL: https://gitlabdemo.chsaos.com/infra/devops-cd.git")]),s._v(" "),a("p",[s._v("Revision: HEAD")]),s._v(" "),a("p",[s._v("Path: rollout-simple-java/")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119210723864.png",alt:"image-20221119210723864"}})]),s._v(" "),a("blockquote",[a("p",[s._v("Cluster URL: https://kubernetes.default.svc")]),s._v(" "),a("p",[s._v("Namespace: myapp-dev")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119210831347.png",alt:"image-20221119210831347"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119210922651.png",alt:"image-20221119210922651"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119212047721.png",alt:"image-20221119212047721"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119212112124.png",alt:"image-20221119212112124"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Kubernetes")]),s._v("中查看服务部署状态信息")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl get pods,svc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" myapp-dev\nNAME                                       READY   STATUS    RESTARTS   AGE\npod/rollouts-simple-java-66979f95b-45jpw   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m3s\npod/rollouts-simple-java-66979f95b-b6cdj   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m3s\npod/rollouts-simple-java-66979f95b-vjzzk   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m3s\n\nNAME                                  TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    AGE\nservice/rollouts-simple-java-canary   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".194.83   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP   4m3s\nservice/rollouts-simple-java-stable   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.97")]),s._v(".5.114    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP   4m3s\n\n$ kubectl get ingress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" myapp-dev\nNAME                                                      CLASS    HOSTS                         ADDRESS   PORTS     AGE\nrollouts-simple-java-rollouts-simple-java-stable-canary   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   testrolloutsdemo.chsaos.com             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("        4m23s\nrollouts-simple-java-stable                               "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   testrolloutsdemo.chsaos.com             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("   4m23s\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"六、jenkins配置项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、jenkins配置项目"}},[s._v("#")]),s._v(" 六、"),a("code",[s._v("Jenkins")]),s._v("配置项目")]),s._v(" "),a("h4",{attrs:{id:"_1-sharelibrary新增jenkinsfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-sharelibrary新增jenkinsfile"}},[s._v("#")]),s._v(" 1."),a("code",[s._v("shareLibrary")]),s._v("新增"),a("code",[s._v("Jenkinsfile")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("rollout-java.Jenkinsfile")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("def labels "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"slave-'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UUID.randomUUID().toString()}")]),s._v('"')]),s._v("\n\n// 引用共享库\n@Library"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jenkins_shareLibrary"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n// 应用共享库中的方法\ndef tools "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.tools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef sonarapi "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.sonarAPI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef sendEmail "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.sendEmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef sonar "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.sonarqube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef gitlab "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.gitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef deploy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" new org.devops.deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n// 前端传来的变量\ndef gitBranch "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.branch\ndef gitUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.git_url\ndef buildShell "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.build_shell\ndef image "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.image\ndef dockerRegistryUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.dockerRegistryUrl\ndef devops_cd_git "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.devops_cd_git\ndef repo_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env.repo_name\n\n// 固定变量\n// def SonarServer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://sonar.devops.svc.cluster.local:9000/api"')]),s._v("\n// def dockerRegistryUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://harbordemo.chsaos.com"')]),s._v("\ndef isUpdate "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n\n\npipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    kubernetes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        label labels\n      yaml "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\napiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    some-label: some-label-value\nspec:\n  volumes:\n  - name: docker-sock\n    hostPath:\n      path: /var/run/docker.sock\n      type: '),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n  - name: maven-cache\n    persistentVolumeClaim:\n      claimName: maven-cache-pvc\n  containers:\n  - name: jnlp\n    image: jenkins/inbound-agent:alpine-jdk8\n  - name: maven\n    image: maven:3.6.1-jdk-8-alpine\n    command:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("\n    tty: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    volumeMounts:\n    - name: maven-cache\n      mountPath: /root/.m2\n  - name: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n    image: docker:20.10.21-alpine3.16\n    command:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("\n    tty: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    volumeMounts:\n    - name: docker-sock\n      mountPath: /var/run/docker.sock\n  - name: sonar-scanner\n    image: sonarsource/sonar-scanner-cli:4.7\n    command:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("\n    tty: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: kustomize\n    image: banna1990/kubecl-kustomize:v1.23.10-v4.5.6\n    command:\n    - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("\n    tty: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'joker'")]),s._v("\n        sonarUser "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v("\n        sonarPwd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin321'")]),s._v("\n        gitServer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://gitlabdemo.chsaos.com/api/v4'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        timestamps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    // 日志会有时间\n        skipDefaultCheckout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   // 删除隐式checkout scm语句\n        disableConcurrentBuilds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   //禁止并行\n        timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time:1,unit:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HOURS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" //设置流水线超时时间\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    parameters "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git_url'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://gitlabdemo.chsaos.com/java/springboot-helloworld.git'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'代码仓库地址'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'branch'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git分支'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build_shell'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn clean package -Dmaven.test.skip=true &&  mv target/*-SNAPSHOT.jar ./myapp.jar'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'build执行命令'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'image'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'harbordemo.chsaos.com/rollout-java-project/myapp'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'镜像名称'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dockerRegistryUrl'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'harbordemo.chsaos.com'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'镜像仓库地址'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'toEmailUser'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jiajia664878380@163.com'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'邮件发送使用的用户'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'devops_cd_git'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gitlabdemo.chsaos.com/infra/devops-cd.git'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kustomization编排文件仓库'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        // 拉取代码\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GetCode'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${gitBranch}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n                    doGenerateSubmoduleConfigurations: false,\n                    extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n                    submoduleCfg: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n                    userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ci-devops'")]),s._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${gitUrl}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        // 单元测试和编译打包\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build&Test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'maven'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"编译打包"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        build.DockerBuild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${buildShell}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        // 代码扫描\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CodeScanner'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sonar-scanner'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码扫描"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"搜索项目"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sonarapi.SearchProject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v("---项目不存在,准备创建项目---\x3e "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            sonarapi.CreateProject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('---项目已存在！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码扫描"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        sonar.SonarScan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"获取扫描结果"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sonarapi.GetProjectStatus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n                        println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result.toString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ERROR"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            toemail.Email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"代码质量阈错误！请及时修复！"')]),s._v(",userEmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            error "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" 代码质量阈错误！请及时修复！"')]),s._v("\n\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        // 构建镜像\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BuildImage'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                withCredentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("usernamePassword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dockerhub'")]),s._v(", \n                passwordVariable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(", \n                usernameVariable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"构建镜像"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            imageTag "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tools.createVersion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                            '),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerRegistryUrl}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${password}")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${imageTag}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${imageTag}")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${imageTag}")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" ./ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.jar"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                        '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        // 部署\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Deploy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                withCredentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("usernamePassword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ci-devops'")]),s._v(", \n                passwordVariable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(", \n                usernameVariable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kustomize'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                         script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("APP_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollout-simple-java"')]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UP_TIME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tools.createVersion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                             '),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /opt/devops-cd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${password}")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${devops_cd_git}")]),s._v(" /opt/devops-cd\n                             "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/devops-cd/\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--global")]),s._v(" user.name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Administrator"')]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--global")]),s._v(" user.email "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jiajia664878380@163.com"')]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${APP_DIR}")]),s._v("\n                             kustomize edit "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${imageTag}")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-am")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"image update '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UP_TIME}")]),s._v('"')]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin main\n                             "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                         '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        // 接口测试\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'InterfaceTest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo \"接口测试\"'")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        // 继续更新或回滚\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UpdateOrRollBack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            input "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                message "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Should we continue?'")]),s._v("\n                ok "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Yes, we should.'")]),s._v("\n                submitter "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alice,bob'")]),s._v("\n                parameters "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input'")]),s._v(", defaultValue: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yes'")]),s._v(", description: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'continue update?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    // 调用更新或者回滚函数\n                    tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"更新或者回滚"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"green"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    // 将input的值赋值给全局变量isUpdate，供下阶段使用\n                    isUpdate "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${input}")]),s._v('"')]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        // 如果是继续更新服务，待验证通过后给gitlab代码仓库打tag\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TagGitlab'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${isUpdate}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yes'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${gitBranch }")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'给仓库打TAG'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'green'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        // 获取项目的projectId\n                        repo_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gitlab.GetProjectID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${repo_name}")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${repo_id}")]),s._v('"')]),s._v("\n                        // 生产tag,以当前时间为tag\n                        tag_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"release"')]),s._v("+"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v("+tools.getTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        gitlab.TagGitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${repo_id}")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tag_name}")]),s._v('"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("else "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        tools.PrintMes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'不打TAG'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'red'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    // 构建后的操作\n    post "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        success "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success:只有构建成功才会执行"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                currentBuild.description "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('构建成功！"')]),s._v("\n                // deploy.AnsibleDeploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${deployHosts}")]),s._v('"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-m ping"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                sendEmail.SendEmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"构建成功"')]),s._v(",toEmailUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                // dingmes.SendDingTalk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"构建成功 ✅"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        failure "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failure:只有构建失败才会执行"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                currentBuild.description "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('构建失败!"')]),s._v("\n                sendEmail.SendEmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"构建失败"')]),s._v(",toEmailUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                // dingmes.SendDingTalk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"构建失败 ❌"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        aborted "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"aborted:只有取消构建才会执行"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                currentBuild.description "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('构建取消!"')]),s._v("\n                sendEmail.SendEmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"取消构建"')]),s._v(",toEmailUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                // dingmes.SendDingTalk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"构建失败 ❌"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"暂停或中断"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br"),a("span",{staticClass:"line-number"},[s._v("161")]),a("br"),a("span",{staticClass:"line-number"},[s._v("162")]),a("br"),a("span",{staticClass:"line-number"},[s._v("163")]),a("br"),a("span",{staticClass:"line-number"},[s._v("164")]),a("br"),a("span",{staticClass:"line-number"},[s._v("165")]),a("br"),a("span",{staticClass:"line-number"},[s._v("166")]),a("br"),a("span",{staticClass:"line-number"},[s._v("167")]),a("br"),a("span",{staticClass:"line-number"},[s._v("168")]),a("br"),a("span",{staticClass:"line-number"},[s._v("169")]),a("br"),a("span",{staticClass:"line-number"},[s._v("170")]),a("br"),a("span",{staticClass:"line-number"},[s._v("171")]),a("br"),a("span",{staticClass:"line-number"},[s._v("172")]),a("br"),a("span",{staticClass:"line-number"},[s._v("173")]),a("br"),a("span",{staticClass:"line-number"},[s._v("174")]),a("br"),a("span",{staticClass:"line-number"},[s._v("175")]),a("br"),a("span",{staticClass:"line-number"},[s._v("176")]),a("br"),a("span",{staticClass:"line-number"},[s._v("177")]),a("br"),a("span",{staticClass:"line-number"},[s._v("178")]),a("br"),a("span",{staticClass:"line-number"},[s._v("179")]),a("br"),a("span",{staticClass:"line-number"},[s._v("180")]),a("br"),a("span",{staticClass:"line-number"},[s._v("181")]),a("br"),a("span",{staticClass:"line-number"},[s._v("182")]),a("br"),a("span",{staticClass:"line-number"},[s._v("183")]),a("br"),a("span",{staticClass:"line-number"},[s._v("184")]),a("br"),a("span",{staticClass:"line-number"},[s._v("185")]),a("br"),a("span",{staticClass:"line-number"},[s._v("186")]),a("br"),a("span",{staticClass:"line-number"},[s._v("187")]),a("br"),a("span",{staticClass:"line-number"},[s._v("188")]),a("br"),a("span",{staticClass:"line-number"},[s._v("189")]),a("br"),a("span",{staticClass:"line-number"},[s._v("190")]),a("br"),a("span",{staticClass:"line-number"},[s._v("191")]),a("br"),a("span",{staticClass:"line-number"},[s._v("192")]),a("br"),a("span",{staticClass:"line-number"},[s._v("193")]),a("br"),a("span",{staticClass:"line-number"},[s._v("194")]),a("br"),a("span",{staticClass:"line-number"},[s._v("195")]),a("br"),a("span",{staticClass:"line-number"},[s._v("196")]),a("br"),a("span",{staticClass:"line-number"},[s._v("197")]),a("br"),a("span",{staticClass:"line-number"},[s._v("198")]),a("br"),a("span",{staticClass:"line-number"},[s._v("199")]),a("br"),a("span",{staticClass:"line-number"},[s._v("200")]),a("br"),a("span",{staticClass:"line-number"},[s._v("201")]),a("br"),a("span",{staticClass:"line-number"},[s._v("202")]),a("br"),a("span",{staticClass:"line-number"},[s._v("203")]),a("br"),a("span",{staticClass:"line-number"},[s._v("204")]),a("br"),a("span",{staticClass:"line-number"},[s._v("205")]),a("br"),a("span",{staticClass:"line-number"},[s._v("206")]),a("br"),a("span",{staticClass:"line-number"},[s._v("207")]),a("br"),a("span",{staticClass:"line-number"},[s._v("208")]),a("br"),a("span",{staticClass:"line-number"},[s._v("209")]),a("br"),a("span",{staticClass:"line-number"},[s._v("210")]),a("br"),a("span",{staticClass:"line-number"},[s._v("211")]),a("br"),a("span",{staticClass:"line-number"},[s._v("212")]),a("br"),a("span",{staticClass:"line-number"},[s._v("213")]),a("br"),a("span",{staticClass:"line-number"},[s._v("214")]),a("br"),a("span",{staticClass:"line-number"},[s._v("215")]),a("br"),a("span",{staticClass:"line-number"},[s._v("216")]),a("br"),a("span",{staticClass:"line-number"},[s._v("217")]),a("br"),a("span",{staticClass:"line-number"},[s._v("218")]),a("br"),a("span",{staticClass:"line-number"},[s._v("219")]),a("br"),a("span",{staticClass:"line-number"},[s._v("220")]),a("br"),a("span",{staticClass:"line-number"},[s._v("221")]),a("br"),a("span",{staticClass:"line-number"},[s._v("222")]),a("br"),a("span",{staticClass:"line-number"},[s._v("223")]),a("br"),a("span",{staticClass:"line-number"},[s._v("224")]),a("br"),a("span",{staticClass:"line-number"},[s._v("225")]),a("br"),a("span",{staticClass:"line-number"},[s._v("226")]),a("br"),a("span",{staticClass:"line-number"},[s._v("227")]),a("br"),a("span",{staticClass:"line-number"},[s._v("228")]),a("br"),a("span",{staticClass:"line-number"},[s._v("229")]),a("br"),a("span",{staticClass:"line-number"},[s._v("230")]),a("br"),a("span",{staticClass:"line-number"},[s._v("231")]),a("br"),a("span",{staticClass:"line-number"},[s._v("232")]),a("br"),a("span",{staticClass:"line-number"},[s._v("233")]),a("br"),a("span",{staticClass:"line-number"},[s._v("234")]),a("br"),a("span",{staticClass:"line-number"},[s._v("235")]),a("br"),a("span",{staticClass:"line-number"},[s._v("236")]),a("br"),a("span",{staticClass:"line-number"},[s._v("237")]),a("br"),a("span",{staticClass:"line-number"},[s._v("238")]),a("br"),a("span",{staticClass:"line-number"},[s._v("239")]),a("br"),a("span",{staticClass:"line-number"},[s._v("240")]),a("br"),a("span",{staticClass:"line-number"},[s._v("241")]),a("br"),a("span",{staticClass:"line-number"},[s._v("242")]),a("br"),a("span",{staticClass:"line-number"},[s._v("243")]),a("br"),a("span",{staticClass:"line-number"},[s._v("244")]),a("br"),a("span",{staticClass:"line-number"},[s._v("245")]),a("br"),a("span",{staticClass:"line-number"},[s._v("246")]),a("br"),a("span",{staticClass:"line-number"},[s._v("247")]),a("br"),a("span",{staticClass:"line-number"},[s._v("248")]),a("br"),a("span",{staticClass:"line-number"},[s._v("249")]),a("br"),a("span",{staticClass:"line-number"},[s._v("250")]),a("br"),a("span",{staticClass:"line-number"},[s._v("251")]),a("br"),a("span",{staticClass:"line-number"},[s._v("252")]),a("br"),a("span",{staticClass:"line-number"},[s._v("253")]),a("br"),a("span",{staticClass:"line-number"},[s._v("254")]),a("br"),a("span",{staticClass:"line-number"},[s._v("255")]),a("br"),a("span",{staticClass:"line-number"},[s._v("256")]),a("br"),a("span",{staticClass:"line-number"},[s._v("257")]),a("br"),a("span",{staticClass:"line-number"},[s._v("258")]),a("br"),a("span",{staticClass:"line-number"},[s._v("259")]),a("br"),a("span",{staticClass:"line-number"},[s._v("260")]),a("br"),a("span",{staticClass:"line-number"},[s._v("261")]),a("br"),a("span",{staticClass:"line-number"},[s._v("262")]),a("br"),a("span",{staticClass:"line-number"},[s._v("263")]),a("br"),a("span",{staticClass:"line-number"},[s._v("264")]),a("br"),a("span",{staticClass:"line-number"},[s._v("265")]),a("br"),a("span",{staticClass:"line-number"},[s._v("266")]),a("br"),a("span",{staticClass:"line-number"},[s._v("267")]),a("br"),a("span",{staticClass:"line-number"},[s._v("268")]),a("br"),a("span",{staticClass:"line-number"},[s._v("269")]),a("br"),a("span",{staticClass:"line-number"},[s._v("270")]),a("br"),a("span",{staticClass:"line-number"},[s._v("271")]),a("br"),a("span",{staticClass:"line-number"},[s._v("272")]),a("br"),a("span",{staticClass:"line-number"},[s._v("273")]),a("br"),a("span",{staticClass:"line-number"},[s._v("274")]),a("br"),a("span",{staticClass:"line-number"},[s._v("275")]),a("br"),a("span",{staticClass:"line-number"},[s._v("276")]),a("br"),a("span",{staticClass:"line-number"},[s._v("277")]),a("br"),a("span",{staticClass:"line-number"},[s._v("278")]),a("br"),a("span",{staticClass:"line-number"},[s._v("279")]),a("br"),a("span",{staticClass:"line-number"},[s._v("280")]),a("br"),a("span",{staticClass:"line-number"},[s._v("281")]),a("br"),a("span",{staticClass:"line-number"},[s._v("282")]),a("br"),a("span",{staticClass:"line-number"},[s._v("283")]),a("br"),a("span",{staticClass:"line-number"},[s._v("284")]),a("br"),a("span",{staticClass:"line-number"},[s._v("285")]),a("br"),a("span",{staticClass:"line-number"},[s._v("286")]),a("br"),a("span",{staticClass:"line-number"},[s._v("287")]),a("br")])]),a("p",[s._v("这里的"),a("code",[s._v("Jenkinfile")]),s._v("和前面的大同小异,只是增加了两个"),a("code",[s._v("stage")]),s._v(",其中"),a("code",[s._v("UpdateOrRollBack")]),s._v("这个"),a("code",[s._v("stag")]),s._v("只是占了一个位置,并没有具体实现,思路如下:")]),s._v(" "),a("ul",[a("li",[s._v("在部署新版本的时候第一次暂停,然后通过"),a("code",[s._v("Jenkins")]),s._v("这里的输入决定是否继续\n"),a("ul",[a("li",[s._v("如果继续则表示该版本上线没什么问题,继续后面的"),a("code",[s._v("TagGitlab")])]),s._v(" "),a("li",[s._v("如果不继续则表示该版本上线有问题,取消本次上线,并将应用回滚至上一版本")])])])]),s._v(" "),a("h4",{attrs:{id:"_2-jenkins配置项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-jenkins配置项目"}},[s._v("#")]),s._v(" 2."),a("code",[s._v("Jenkins")]),s._v("配置项目")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Jenkins")]),s._v("上"),a("code",[s._v("JOB")]),s._v("名字的前缀和"),a("code",[s._v("YAML")]),s._v("清单所在的文件名一致")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("任务名称")]),s._v(": rollout-simple-java_TEST")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119215525360.png",alt:"image-20221119215525360"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119215645517.png",alt:"image-20221119215645517"}})]),s._v(" "),a("h5",{attrs:{id:"添加参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加参数"}},[s._v("#")]),s._v(" 添加参数")]),s._v(" "),a("blockquote",[a("p",[s._v("名称: git_url")]),s._v(" "),a("p",[s._v("默认值: http://gitlabdemo.chsaos.com/java/springboot-helloworld.git")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119215918618.png",alt:"image-20221119215918618"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: branch")]),s._v(" "),a("p",[s._v("默认值: main")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119220028418.png",alt:"image-20221119220028418"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: build_shell")]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("mvn clean package -Dmaven.test.skip=true && mv target/*-SNAPSHOT.jar ./myapp.jar")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119220221171.png",alt:"image-20221119220221171"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: image")]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("harbordemo.chsaos.com/rollout-java-project/myapp")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119220338635.png",alt:"image-20221119220338635"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: "),a("code",[s._v("dockerRegistryUrl")])]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("harbordemo.chsaos.com")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119220504625.png",alt:"image-20221119220504625"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: "),a("code",[s._v("toEmailUser")])]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("jiajia664878380@163.com")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119220635016.png",alt:"image-20221119220635016"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: "),a("code",[s._v("devops_cd_git")])]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("gitlabdemo.chsaos.com/infra/devops-cd.git")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119220806775.png",alt:"image-20221119220806775"}})]),s._v(" "),a("blockquote",[a("p",[s._v("名称: "),a("code",[s._v("repo_name")])]),s._v(" "),a("p",[s._v("默认值: "),a("code",[s._v("springboot-helloworld")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119221100462.png",alt:"image-20221119221100462"}})]),s._v(" "),a("blockquote",[a("p",[s._v("Repository URL: https://gitlabdemo.chsaos.com/infra/sharelibrary.git")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119221236585.png",alt:"image-20221119221236585"}})]),s._v(" "),a("blockquote",[a("p",[s._v("指定分支: "),a("code",[s._v("*/main")])]),s._v(" "),a("p",[s._v("脚本路径: "),a("code",[s._v("rollout-java.Jenkinsfile")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119221454596.png",alt:"image-20221119221454596"}})]),s._v(" "),a("h3",{attrs:{id:"七、发布应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、发布应用"}},[s._v("#")]),s._v(" 七、发布应用")]),s._v(" "),a("h4",{attrs:{id:"_1-集成gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-集成gitlab"}},[s._v("#")]),s._v(" 1.集成"),a("code",[s._v("Gitlab")])]),s._v(" "),a("h5",{attrs:{id:"通过webhook触发jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过webhook触发jenkins"}},[s._v("#")]),s._v(" 通过"),a("code",[s._v("Webhook")]),s._v("触发"),a("code",[s._v("Jenkins")])]),s._v(" "),a("blockquote",[a("p",[s._v("在"),a("code",[s._v("Jenkins")]),s._v("中选择项目,在项目中配置"),a("code",[s._v("gitlab")]),s._v("触发")]),s._v(" "),a("p",[a("code",[s._v("GitLab. GitLab webhook UR")]),s._v(": http://jenkinsdemo.chsaos.com/project/rollout-simple-java_TEST")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233015594.png",alt:"image-20221119233015594"}})]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("Secret token")]),s._v(": "),a("code",[s._v("2550164455ebd09fa2e346761de5260e")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233141131.png",alt:"image-20221119233141131"}})]),s._v(" "),a("h5",{attrs:{id:"gitlab上配置集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab上配置集成"}},[s._v("#")]),s._v(" "),a("code",[s._v("Gitlab")]),s._v("上配置集成")]),s._v(" "),a("blockquote",[a("p",[s._v("进入项目--\x3e项目设置--\x3e集成")]),s._v(" "),a("p",[s._v("项目名称: "),a("code",[s._v("springboot-helloworld")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233301545.png",alt:"image-20221119233301545"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("配置"),a("code",[s._v("Jenkins")]),s._v("上生成的回调"),a("code",[s._v("URL")]),s._v("和"),a("code",[s._v("TOKEN")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("GitLab. GitLab webhook UR")]),s._v(": http://jenkinsdemo.chsaos.com/project/rollout-simple-java_TEST")]),s._v(" "),a("p",[a("code",[s._v("Secret token")]),s._v(": "),a("code",[s._v("2550164455ebd09fa2e346761de5260e")])])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233513742.png",alt:"image-20221119233513742"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233538118.png",alt:"image-20221119233538118"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233607075.png",alt:"image-20221119233607075"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Gitlab")]),s._v("手动发送"),a("code",[s._v("test")]),s._v("观察是否触发流水线")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119233718079.png",alt:"image-20221119233718079"}})]),s._v(" "),a("ul",[a("li",[s._v("到"),a("code",[s._v("Argocd")]),s._v("WEB界面"),a("code",[s._v("rollout-simple-java")]),s._v("应用正在同步")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119234638266.png",alt:"image-20221119234638266"}})]),s._v(" "),a("blockquote",[a("p",[s._v("这里暂时没有在"),a("code",[s._v("Jenkins")]),s._v("上没有完成,在"),a("code",[s._v("Argo Rollouts")]),s._v("确认发布或者回滚的功能")]),s._v(" "),a("p",[s._v("这里会暂停一段时间后,会自动恢复正常健康状态")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119234811574.png",alt:"image-20221119234811574"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119235307294.png",alt:"image-20221119235307294"}})]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("Jenkins JOB")]),s._v("上进行确认")]),s._v(" "),a("blockquote",[a("p",[s._v("这里的"),a("code",[s._v("Jenkins")]),s._v("的确认是虚假的展示;后端暂时没有完成这个功能")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119234912620.png",alt:"image-20221119234912620"}})]),s._v(" "),a("h4",{attrs:{id:"_2-命令行终端使用curl测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-命令行终端使用curl测试"}},[s._v("#")]),s._v(" 2.命令行终端使用"),a("code",[s._v("curl")]),s._v("测试")]),s._v(" "),a("ul",[a("li",[s._v("访问域名: "),a("code",[s._v("https://testrolloutsdemo.chsaos.com/hello")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221119234203974.png",alt:"image-20221119234203974"}})]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://testrolloutsdemo.chsaos.com/hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/meta"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Hello World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("Hello World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("meta "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/meta"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Hello World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("Hello World"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("ul",[a("li",[s._v("修改源代码将"),a("code",[s._v("Hello World!")]),s._v("修改为"),a("code",[s._v("Hello Bruce!")]),s._v("如下:")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000111562.png",alt:"image-20221120000111562"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Jenkins JOB")]),s._v("进行确认")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000400793.png",alt:"image-20221120000400793"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Arogcd")]),s._v(" 上查看"),a("code",[s._v("rollout-simple-java")]),s._v("应用的状态变化")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000420333.png",alt:"image-20221120000420333"}})]),s._v(" "),a("p",[a("strong",[s._v("这里暂时暂停状态")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000539767.png",alt:"image-20221120000539767"}})]),s._v(" "),a("p",[a("strong",[s._v("这里已经在做最新版本的部署")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000643775.png",alt:"image-20221120000643775"}})]),s._v(" "),a("p",[a("strong",[s._v("最新版本部署完成")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000716909.png",alt:"image-20221120000716909"}})]),s._v(" "),a("p",[a("strong",[s._v("在Kubernetes集群上查看pod的部署状态")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120000747138.png",alt:"image-20221120000747138"}})]),s._v(" "),a("p",[a("strong",[s._v("这里所有流量已经完全切换到新版本上")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120001527362.png",alt:"image-20221120001527362"}})]),s._v(" "),a("p",[a("strong",[s._v("命令行端已经所有的流量都切换到最新发布的内容上")])]),s._v(" "),a("p",[a("img",{attrs:{src:"E:%5Cnotes%5CCI-CD%5CCICD(2)%5CCICD%5CCICD%5Cimages%5Cimage-20221120000504287.png",alt:"image-20221120000504287"}})]),s._v(" "),a("p",[a("strong",[s._v("WEB浏览器上展示内容也已经变化了")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120001658408.png",alt:"image-20221120001658408"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("GitLab")]),s._v("代码仓库查看新的"),a("code",[s._v("Tag")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120003127818.png",alt:"image-20221120003127818"}})]),s._v(" "),a("p",[a("strong",[s._v("查看更改的代码部分")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120003215733.png",alt:"image-20221120003215733"}})]),s._v(" "),a("h3",{attrs:{id:"八、argo-rollouts-dashoard安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、argo-rollouts-dashoard安装"}},[s._v("#")]),s._v(" 八、"),a("code",[s._v("Argo Rollouts Dashoard")]),s._v("安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/argoproj/argo-rollouts.git /root/argo-rollouts\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rp")]),s._v(" /root/argo-rollouts/manifests/dashboard-install /home/kubernetes-software-yaml/\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/kubernetes-software-yaml/argo-rollouts-dashboard-install\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提前创建好ssl的`Secret`")]),s._v("\nkubectl create secret tls argorollouts-tls "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cert")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/kubernetes-software-yaml/ssl/chsaos.com.crt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/kubernetes-software-yaml/ssl/chsaos.com.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新增加`ingress`编排文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" dashboard-ingress.yaml\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: argo-rollouts-dashboard\n  annotations:\n    kubernetes.io/ingress.class: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n    nginx.ingress.kubernetes.io/ssl-redirect: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\nspec:\n  rules:\n  - host: argorollouts.chsaos.com\n    http:\n      paths:\n      - pathType: Prefix\n        path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        backend:\n          service:\n            name: argo-rollouts-dashboard\n            port:\n              number: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3100")]),s._v("\n  tls:\n  - hosts: \n    - argorollouts.chsaos.com\n    secretName: argorollouts-tls\n    \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑`kustomization.yaml`增加ingress编排文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kustomization.yaml\n--- \napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n- dashboard-clusterrolebinding.yaml\n- dashboard-clusterrole.yaml\n- dashboard-deployment.yaml\n- dashboard-service.yaml\n- dashboard-serviceaccount.yaml\n- dashboard-ingress.yaml\nimages:\n- name: quay.io/argoproj/kubectl-argo-rollouts\n  newTag: latest\n\n\n$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --dry-run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务状态信息")]),s._v("\n$ kubectl get pods,svc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts\n$ kubectl get ingress "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" argo-rollouts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120010944276.png",alt:"image-20221120010944276"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bruce-log-img.oss-cn-shanghai.aliyuncs.com/image-20221120011017065.png",alt:"image-20221120011017065"}})]),s._v(" "),a("h3",{attrs:{id:"九、总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、总结"}},[s._v("#")]),s._v(" 九、总结")]),s._v(" "),a("p",[a("code",[s._v("Argocd")]),s._v("和"),a("code",[s._v("Argo Rollouts")]),s._v(",初步测试结果运行都比较稳定;但"),a("code",[s._v("Argocd")]),s._v("有如下几点需要注意:")]),s._v(" "),a("ul",[a("li",[s._v("备份"),a("code",[s._v("argocd")]),s._v("上每个应用"),a("code",[s._v("yaml")]),s._v("文件,因为"),a("code",[s._v("argocd")]),s._v("本身是无状态的,保不齐什么时候就会被清空")]),s._v(" "),a("li",[a("code",[s._v("argocd-cm")]),s._v("的"),a("code",[s._v("configMap")]),s._v("每次修改过后会清空部署在的应用,不过对应用本身不影响,上面的备份是为了方便重建")]),s._v(" "),a("li",[a("code",[s._v("argo rollouts")]),s._v("对"),a("code",[s._v("ingress")]),s._v("的支持有限,目前只支持"),a("code",[s._v("ingress")]),s._v("和"),a("code",[s._v("alb")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);